/*! the-hive */
var RedactorPlugins;!function(p){"use strict";Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;return function(){return e.apply(t)}});var o=0;function a(t,e){return new a.prototype.init(t,e)}p.fn.redactor=function(i){var s=[],o=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each(function(){var t,e=p.data(this,"redactor");"-1"!=i.search(/\./)?void 0!==e[(t=i.split("."))[0]]&&(t=e[t[0]][t[1]]):t=e[i],void 0!==e&&"function"==typeof t?void 0!==(t=t.apply(e,o))&&t!==e&&s.push(t):p.error('No such method "'+i+'" for Redactor')}):this.each(function(){p.data(this,"redactor",{}),p.data(this,"redactor",a(this,i))}),0===s.length?this:1===s.length?s[0]:s},p.Redactor=a,p.Redactor.VERSION="10.2.2",p.Redactor.modules=["alignment","autosave","block","buffer","build","button","caret","clean","code","core","dropdown","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","modal","observe","paragraphize","paste","placeholder","progress","selection","shortcuts","tabifier","tidy","toolbar","upload","utils"],p.Redactor.opts={lang:"en",direction:"ltr",plugins:!1,focus:!1,focusEnd:!1,placeholder:!1,visual:!0,tabindex:!1,minHeight:!1,maxHeight:!1,linebreaks:!1,replaceDivs:!0,paragraphize:!0,cleanStyleOnEnter:!1,enterKey:!0,cleanOnPaste:!0,cleanSpaces:!0,pastePlainText:!1,autosave:!1,autosaveName:!1,autosaveInterval:60,autosaveOnChange:!1,autosaveFields:!1,linkTooltip:!0,linkProtocol:"http",linkNofollow:!1,linkSize:50,imageEditable:!0,imageLink:!0,imagePosition:!0,imageFloatMargin:"10px",imageResizable:!0,imageUpload:null,imageUploadParam:"file",uploadImageField:!1,dragImageUpload:!0,fileUpload:null,fileUploadParam:"file",dragFileUpload:!0,s3:!1,convertLinks:!0,convertUrlLinks:!0,convertImageLinks:!0,convertVideoLinks:!0,preSpaces:4,tabAsSpaces:!1,tabKey:!0,scrollTarget:!1,toolbar:!0,toolbarFixed:!1,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,source:!0,buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","link","alignment","horizontalrule"],buttonsHide:[],buttonsHideOnMobile:[],formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,tabifier:!0,deniedTags:["script","style"],allowedTags:!1,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],removeComments:!1,replaceTags:[["strike","del"],["b","strong"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:!1,removeAttr:!1,allowedAttr:!1,removeWithoutAttr:["span"],removeEmpty:["p"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,concrete5:{filemanager:!1,sitemap:!1,lightbox:!1,mailer:!1},buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["a","img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"],highContrast:!1,observe:{dropdowns:[]},langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",alt:"Alt",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code or Youtube/Vimeo Link",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",link_same_window:"Open link in same window",in_lightbox:"Open link in Lightbox",lightbox_link_type:"Link Type",lightbox_link_type_iframe:"Web Page",lightbox_link_type_image:"Image",lightbox_link_type_iframe_options:"Frame Options",lightbox_link_type_iframe_width:"Width",lightbox_link_type_iframe_height:"Height",customStyles:"Custom Styles",remove_font:"Remove font",change_font_family:"Change font family",remove_font_size:"Remove font size",change_font_size:"Change font size",remove_style:"Remove Style",insert_character:"Insert Character",undo:"Undo",redo:"Redo",remove_font_family:"Remove Font Family",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit",upload_label:"Drop file here or "}},linkify:{regexps:{youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,image:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},codemirror:!1},a.fn=p.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(t,e){if(this.$element=p(t),this.uuid=o++,this.rtePaste=!1,this.$pasteBox=!1,this.loadOptions(e),this.loadModules(),this.formatting={},p.merge(this.opts.blockLevelElements,this.opts.alignmentTags),this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.tidy.setupAllowed(),!1!==this.opts.deniedTags)for(var i=["html","head","link","body","meta","applet"],s=0;s<i.length;s++)this.opts.deniedTags.push(i[s]);this.lang.load(),p.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.core.setCallback("start"),this.start=!0,this.build.run()},loadOptions:function(t){this.opts=p.extend({},p.extend(!0,{},p.Redactor.opts),this.$element.data(),t)},getModuleMethods:function(e){return Object.getOwnPropertyNames(e).filter(function(t){return"function"==typeof e[t]})},loadModules:function(){for(var t=p.Redactor.modules.length,e=0;e<t;e++)this.bindModuleMethods(p.Redactor.modules[e])},bindModuleMethods:function(t){if(void 0!==this[t]){this[t]=this[t]();for(var e=this.getModuleMethods(this[t]),i=e.length,s=0;s<i;s++)this[t][e[s]]=this[t][e[s]].bind(this)}},alignment:function(){return{left:function(){this.alignment.set("")},right:function(){this.alignment.set("right")},center:function(){this.alignment.set("center")},justify:function(){this.alignment.set("justify")},set:function(t){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save(),this.alignment.blocks=this.selection.getBlocks(),this.alignment.type=t,this.alignment.isLinebreaksOrNoBlocks()?this.alignment.setText():this.alignment.setBlocks(),this.selection.restore(),this.code.sync()},setText:function(){var t=this.selection.wrap("div");p(t).attr("data-tagblock","redactor").css("text-align",this.alignment.type)},setBlocks:function(){p.each(this.alignment.blocks,p.proxy(function(t,e){e=this.utils.getAlignmentElement(e);e&&(this.alignment.isNeedReplaceElement(e)?this.alignment.replaceElement(e):this.alignment.alignElement(e))},this))},isLinebreaksOrNoBlocks:function(){return this.opts.linebreaks&&!1===this.alignment.blocks[0]},isNeedReplaceElement:function(t){return""===this.alignment.type&&void 0!==t.data("tagblock")},replaceElement:function(t){t.replaceWith(t.html())},alignElement:function(t){t.css("text-align",this.alignment.type),this.utils.removeEmptyAttr(t,"style")}}},autosave:function(){return{html:!1,enable:function(){this.opts.autosave&&(this.autosave.name=this.opts.autosaveName||this.$textarea.attr("name"),this.opts.autosaveOnChange||(this.autosaveInterval=setInterval(this.autosave.load,1e3*this.opts.autosaveInterval)))},onChange:function(){this.opts.autosaveOnChange&&this.autosave.load()},load:function(){var t;this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source&&((t={}).name=this.autosave.name,t[this.autosave.name]=this.autosave.source,t=this.autosave.getHiddenFields(t),p.ajax({url:this.opts.autosave,type:"post",data:t}).done(this.autosave.success))},getHiddenFields:function(i){return!1!==this.opts.autosaveFields&&"object"==typeof this.opts.autosaveFields&&p.each(this.opts.autosaveFields,p.proxy(function(t,e){null!==e&&0===e.toString().indexOf("#")&&(e=p(e).val()),i[t]=e},this)),i},success:function(e){var i;try{i=p.parseJSON(e)}catch(t){i=e}e=void 0===i.error?"autosave":"autosaveError";this.core.setCallback(e,this.autosave.name,i),this.autosave.html=this.autosave.source},disable:function(){clearInterval(this.autosaveInterval)}}},block:function(){return{formatting:function(t){var e,i;this.block.clearStyle=!1,void 0!==this.formatting[t].data?e="data":void 0!==this.formatting[t].attr?e="attr":void 0!==this.formatting[t].class&&(e="class"),void 0!==this.formatting[t].clear&&(this.block.clearStyle=!0),e&&(i=this.formatting[t][e]),this.block.format(this.formatting[t].tag,e,i)},format:function(t,e,i){var s;-1!=p.inArray(t="quote"==t?"blockquote":t,["p","pre","blockquote","h1","h2","h3","h4","h5","h6"])&&(this.block.isRemoveInline="pre"==t||-1!=t.search(/h[1-6]/i),this.utils.browser("msie")||this.$editor.focus(),s=this.$editor.html().trim(),this.block.isEmpty=this.utils.isEmpty(s),this.utils.browser("mozilla")&&!this.focus.isFocused()&&this.block.isEmpty&&!this.opts.linebreaks&&(s=this.$editor.children().first(),this.caret.setEnd(s)),this.block.blocks=this.selection.getBlocks(),this.block.blocksSize=this.block.blocks.length,this.block.type=e,this.block.value=i,this.buffer.set(),this.selection.save(),this.block.set(t),this.selection.restore(),this.code.sync(),this.observe.load())},set:function(t){this.selection.get(),this.block.containerTag=this.range.commonAncestorContainer.tagName,this.range.collapsed?this.block.setCollapsed(t):this.block.setMultiple(t)},setCollapsed:function(t){if(this.opts.linebreaks&&this.block.isEmpty&&"p"!=t)i=document.createElement(t),this.$editor.html(i),this.caret.setEnd(i);else{var e,i=this.block.blocks[0];if(!1!==i){if("LI"==i.tagName)return"blockquote"!=t?void 0:void this.block.formatListToBlockquote();("TD"==this.block.containerTag||"TH"==this.block.containerTag)&&!this.opts.linebreaks?(document.execCommand("formatblock",!1,"<"+t+">"),i=this.selection.getBlock(),this.block.toggle(p(i))):i.tagName.toLowerCase()!=t?this.opts.linebreaks&&"p"==t?(p(i).append("<br>"),this.utils.replaceWithContents(i)):(e=this.utils.replaceToTag(i,t),this.block.toggle(e),"p"!=t&&"blockquote"!=t&&e.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(e),"p"!=t&&!this.block.headTag||e.find("p").contents().unwrap(),this.block.formatTableWrapping(e)):"blockquote"==t&&i.tagName.toLowerCase()==t?this.opts.linebreaks?(p(i).append("<br>"),this.utils.replaceWithContents(i)):(e=this.utils.replaceToTag(i,"p"),this.block.toggle(e)):i.tagName.toLowerCase()==t&&this.block.toggle(p(i)),void 0===this.block.type&&void 0===this.block.value&&p(i).removeAttr("class").removeAttr("style")}}},setMultiple:function(i){var t,e=this.block.blocks[0],s="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(!1!==e&&1===this.block.blocksSize)e.tagName.toLowerCase()==i&&"blockquote"==i?this.opts.linebreaks?(p(e).append("<br>"),this.utils.replaceWithContents(e)):(t=this.utils.replaceToTag(e,"p"),this.block.toggle(t)):"LI"==e.tagName?"blockquote"==i&&this.block.formatListToBlockquote():"BLOCKQUOTE"==this.block.containerTag?this.block.formatBlockquote(i):this.opts.linebreaks&&(s||this.range.commonAncestorContainer!=e)?this.block.formatWrap(i):this.opts.linebreaks&&"p"==i?(p(e).prepend("<br>").append("<br>"),this.utils.replaceWithContents(e)):"TD"===e.tagName?this.block.formatWrap(i):(t=this.utils.replaceToTag(e,i),this.block.toggle(t),this.block.isRemoveInline&&this.utils.removeInlineTags(t),"p"!=i&&!this.block.headTag||t.find("p").contents().unwrap());else if(this.opts.linebreaks||"p"!=i){if("blockquote"==i){for(var o=0,r=0;r<this.block.blocksSize;r++)"BLOCKQUOTE"==this.block.blocks[r].tagName&&o++;if(o==this.block.blocksSize)return void p.each(this.block.blocks,p.proxy(function(t,e){var i=!1;(i=this.opts.linebreaks?(p(e).prepend("<br>").append("<br>"),this.utils.replaceWithContents(e)):this.utils.replaceToTag(e,"p"))&&void 0===this.block.type&&void 0===this.block.value&&i.removeAttr("class").removeAttr("style")},this))}this.block.formatWrap(i)}else{var a=!1,n=("class"==this.block.type&&(a="toggle",s=p(this.block.blocks).filter("."+this.block.value).length,this.block.blocksSize==s?a="toggle":(this.block.blocksSize>s||0===s)&&(a="set")),["ul","ol","li","td","th","dl","dt","dd"]);p.each(this.block.blocks,p.proxy(function(t,e){-1==p.inArray(e.tagName.toLowerCase(),n)&&(e=this.utils.replaceToTag(e,i),!a||"toggle"==a?this.block.toggle(e):"remove"==a?this.block.remove(e):"set"==a&&this.block.setForce(e),"p"!=i&&"blockquote"!=i&&e.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(e),"p"!=i&&!this.block.headTag||e.find("p").contents().unwrap(),void 0===this.block.type)&&void 0===this.block.value&&e.removeAttr("class").removeAttr("style")},this))}},setForce:function(t){this.block.clearStyle&&t.removeAttr("class").removeAttr("style"),"class"==this.block.type?t.addClass(this.block.value):"attr"!=this.block.type&&"data"!=this.block.type||t.attr(this.block.value.name,this.block.value.value)},toggle:function(t){this.block.clearStyle&&t.removeAttr("class").removeAttr("style"),"class"==this.block.type?t.toggleClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?t.attr(this.block.value.name)==this.block.value.value?t.removeAttr(this.block.value.name):t.attr(this.block.value.name,this.block.value.value):t.removeAttr("style class")},remove:function(t){t.removeClass(this.block.value)},formatListToBlockquote:function(){var t=p(this.block.blocks[0]).closest("ul, ol",this.$editor[0]),t=(p(t).find("ul, ol").contents().unwrap(),p(t).find("li").append(p("<br>")).contents().unwrap(),this.utils.replaceToTag(t,"blockquote"));this.block.toggle(t)},formatBlockquote:function(t){document.execCommand("outdent"),document.execCommand("formatblock",!1,t),this.clean.clearUnverified(),this.$editor.find("p:empty").remove();var e=this.selection.getBlock();"p"!=t&&p(e).find("img").remove(),this.opts.linebreaks||this.block.toggle(p(e)),this.$editor.find("ul, ol, tr, blockquote, p").each(p.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&"p"==t&&this.utils.replaceWithContents(e)},formatWrap:function(t){if("UL"==this.block.containerTag||"OL"==this.block.containerTag){if("blockquote"!=t)return;this.block.formatListToBlockquote()}var e,i=this.selection.wrap(t);!1!==i&&(i=p(i),this.block.formatTableWrapping(i),i.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr").contents().unwrap(),"p"!=t&&"blockquote"!=t&&i.find("img").remove(),p.each(this.block.blocks,p.proxy(this.utils.removeEmpty,this)),i.append(this.selection.getMarker(2)),this.opts.linebreaks||this.block.toggle(i),this.$editor.find("ul, ol, tr, blockquote, p").each(p.proxy(this.utils.removeEmpty,this)),i.find("blockquote:empty").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(i),this.opts.linebreaks&&"p"==t&&this.utils.replaceWithContents(i),this.opts.linebreaks)&&0!=(e=i.next().next()).size()&&"BR"===e[0].tagName&&e.remove()},formatTableWrapping:function(t){0!==t.closest("table",this.$editor[0]).length&&(0===t.closest("tr",this.$editor[0]).length&&t.wrap("<tr>"),0===t.closest("td",this.$editor[0]).length)&&0===t.closest("th").length&&t.wrap("<td>")},removeData:function(t,e){var i=this.selection.getBlocks();p(i).removeAttr("data-"+t),this.code.sync()},setData:function(t,e){var i=this.selection.getBlocks();p(i).attr("data-"+t,e),this.code.sync()},toggleData:function(t,e){var i=this.selection.getBlocks();p.each(i,function(){p(this).attr("data-"+t)?p(this).removeAttr("data-"+t):p(this).attr("data-"+t,e)})},removeAttr:function(t,e){var i=this.selection.getBlocks();p(i).removeAttr(t),this.code.sync()},setAttr:function(t,e){var i=this.selection.getBlocks();p(i).attr(t,e),this.code.sync()},toggleAttr:function(t,e){var i=this.selection.getBlocks();p.each(i,function(){p(this).attr(name)?p(this).removeAttr(name):p(this).attr(name,e)})},removeClass:function(t){var e=this.selection.getBlocks();p(e).removeClass(t),this.utils.removeEmptyAttr(e,"class"),this.code.sync()},setClass:function(t){var e=this.selection.getBlocks();p(e).addClass(t),this.code.sync()},toggleClass:function(t){var e=this.selection.getBlocks();p(e).toggleClass(t),this.code.sync()}}},buffer:function(){return{set:function(t){void 0===t||"undo"==t?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){this.selection.save(),this.opts.buffer.push(this.$editor.html()),this.selection.restore()},setRedo:function(){this.selection.save(),this.opts.rebuffer.push(this.$editor.html()),this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){0!==this.opts.buffer.length&&(this.buffer.set("redo"),this.buffer.getUndo(),this.selection.restore(),setTimeout(p.proxy(this.observe.load,this),50))},redo:function(){0!==this.opts.rebuffer.length&&(this.buffer.set("undo"),this.buffer.getRedo(),this.selection.restore(),setTimeout(p.proxy(this.observe.load,this),50))}}},build:function(){return{run:function(){this.build.createContainerBox(),this.build.loadContent(),this.build.loadEditor(),this.build.enableEditor(),this.build.setCodeAndCall()},isTextarea:function(){return"TEXTAREA"===this.$element[0].tagName},createContainerBox:function(){this.$box=p('<div class="redactor-box" />')},createTextarea:function(){this.$textarea=p("<textarea />").attr("name",this.build.getTextareaName())},getTextareaName:function(){return"undefined"==typeof name?"content-"+this.uuid:this.$element.attr("id")},loadContent:function(){var t=this.build.isTextarea()?"val":"html";this.content=this.$element[t]().trim()},enableEditor:function(){this.$editor.attr({contenteditable:!0,dir:this.opts.direction})},loadEditor:function(){var t=this.build.isTextarea()?"fromTextarea":"fromElement";this.build[t]()},fromTextarea:function(){this.$editor=p("<div />"),this.$textarea=this.$element,this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-editor"),this.$editor.attr({"aria-label":"Your Comment","aria-multiline":"true",role:"textbox"}),this.$element.hide()},fromElement:function(){this.$editor=this.$element,this.build.createTextarea(),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea),this.$editor.addClass("redactor-editor"),this.$textarea.hide()},setCodeAndCall:function(){this.code.set(this.content),this.build.setOptions(),this.build.callEditor(),this.opts.visual||setTimeout(p.proxy(this.code.showCode,this),200)},callEditor:function(){this.build.disableMozillaEditing(),this.build.disableIeLinks(),this.build.setEvents(),this.build.setHelpers(),this.opts.toolbar&&(this.opts.toolbar=this.toolbar.init(),this.toolbar.build()),this.modal.loadTemplates(),this.build.plugins(),setTimeout(p.proxy(this.observe.load,this),4),this.core.setCallback("init")},setOptions:function(){p(this.$textarea).attr("dir",this.opts.direction),this.opts.linebreaks&&this.$editor.addClass("redactor-linebreaks"),this.opts.tabindex&&this.$editor.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&this.$editor.css("minHeight",this.opts.minHeight),this.opts.maxHeight&&this.$editor.css("maxHeight",this.opts.maxHeight)},setEventDropUpload:function(t){var e;t.preventDefault(),this.opts.dragImageUpload&&this.opts.dragFileUpload&&(e=t.dataTransfer.files,this.upload.directUpload(e[0],t))},setEventDrop:function(t){this.code.sync(),setTimeout(this.clean.clearUnverified,1),this.core.setCallback("drop",t)},setEvents:function(){this.$editor.on("drop.redactor",p.proxy(function(t){return t=t.originalEvent||t,void 0===window.FormData||!t.dataTransfer||(0===t.dataTransfer.files.length?this.build.setEventDrop(t):(this.build.setEventDropUpload(t),setTimeout(this.clean.clearUnverified,1),void this.core.setCallback("drop",t)))},this)),this.$editor.on("click.redactor",p.proxy(function(t){var e=this.core.getEvent();this.core.addEvent("click"!=e&&"arrow"!=e&&"click"),this.utils.disableSelectAll(),this.core.setCallback("click",t)},this)),this.$editor.on("paste.redactor",p.proxy(this.paste.init,this)),this.$editor.on("cut.redactor",p.proxy(this.code.sync,this)),this.$editor.on("keydown.redactor",p.proxy(this.keydown.init,this)),this.$editor.on("keyup.redactor",p.proxy(this.keyup.init,this)),"function"==typeof this.opts.codeKeydownCallback&&this.$textarea.on("keydown.redactor-textarea",p.proxy(this.opts.codeKeydownCallback,this)),"function"==typeof this.opts.codeKeyupCallback&&this.$textarea.on("keyup.redactor-textarea",p.proxy(this.opts.codeKeyupCallback,this)),"function"==typeof this.opts.focusCallback&&this.$editor.on("focus.redactor",p.proxy(this.opts.focusCallback,this)),p(document).on("mousedown.redactor."+this.uuid,p.proxy(function(t){this.blurClickedElement=t.target},this)),this.$editor.on("blur.redactor",p.proxy(function(t){this.start||this.rtePaste||this.build.isBlured()&&(this.utils.disableSelectAll(),"function"==typeof this.opts.blurCallback)&&this.core.setCallback("blur",t)},this))},isBlured:function(){var t;return!0===this.blurClickedElement||!(t=p(this.blurClickedElement)).hasClass("redactor-toolbar, redactor-dropdown")&&!t.is("#redactor-modal")&&0===t.parents(".redactor-toolbar, .redactor-dropdown, #redactor-modal").length},setHelpers:function(){this.linkify.isEnabled()&&this.linkify.format(),this.placeholder.enable(),this.opts.focus&&setTimeout(this.focus.setStart,100),this.opts.focusEnd&&setTimeout(this.focus.setEnd,100)},plugins:function(){this.opts.plugins&&p.each(this.opts.plugins,p.proxy(function(t,e){var i=void 0!==RedactorPlugins&&void 0!==RedactorPlugins[e]?RedactorPlugins:a.fn;if("function"==typeof i[e]){this[e]=i[e]();for(var s=this.getModuleMethods(this[e]),o=s.length,r=0;r<o;r++)this[e][s[r]]=this[e][s[r]].bind(this);"function"==typeof this[e].init&&this[e].init()}},this))},disableMozillaEditing:function(){if(this.utils.browser("mozilla"))try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){}},disableIeLinks:function(){this.utils.browser("msie")&&document.execCommand("AutoUrlDetect",!1,!1)}}},button:function(){return{getClass:function(t){switch(t){case"html":return"fa fa-code";case"formatting":case"formatting-concrete5":return"fa fa-paragraph";case"orderedlist":return"fa fa-list-ol";case"unorderedlist":return"fa fa-list-ul";case"video":return"fa fa-file-video-o";case"alignment":return"fa fa-align-left";case"horizontalrule":return"fa fa-minus";case"deleted":return"fa fa-strikethrough";case"fontfamily":return"fa fa-font";case"fontsize":return"fa fa-text-height";case"fontcolor":case"backcolor":return"fa fa-tint";case"bold":return"fa fa-bold";case"italic":return"fa fa-italic";case"outdent":return"fa fa-outdent";case"indent":return"fa fa-indent";case"image":return"fa fa-image";case"link":return"fa fa-link";case"underline":return"fa fa-underline"}},build:function(t,e){var i,s=p('<a href="#" class="re-icon re-'+t+'" rel="'+t+'"><i class="'+this.button.getClass(t)+'" aria-hidden="true"></i></a>').attr({role:"Button","aria-label":t,"aria-pressed":!1});return(e.func||e.command||e.dropdown)&&this.button.setEvent(s,t,e),e.dropdown&&(i=p('<ul class="dropdown-menu redactor-dropdown redactor-dropdown-'+ +this.uuid+" redactor-dropdown-box-"+t+'" style="display: none;">'),s.data("dropdown",i),this.dropdown.build(t,i,e.dropdown)),this.utils.isDesktop()&&this.button.createTooltip(s,t,e.title),s},setEvent:function(s,o,r){s.on("touchstart click",p.proxy(function(t){if(s.hasClass("redactor-button-disabled"))return!1;var e="func",i=r.func;r.command?(e="command",i=r.command):r.dropdown&&(i=!(e="dropdown")),this.button.onClick(t,o,e,i)},this))},createTooltip:function(e,t,i){var s=p("<span>").addClass("redactor-toolbar-tooltip redactor-toolbar-tooltip-"+this.uuid+" redactor-toolbar-tooltip-"+t).hide().html(i);s.appendTo("body"),e.on("mouseover",function(){var t;p(this).hasClass("redactor-button-disabled")||(t=e.offset(),s.show(),s.css({top:t.top+e.innerHeight()+"px",left:t.left+e.innerWidth()/2-s.innerWidth()/2+"px"}))}),e.on("mouseout",function(){s.hide()})},onClick:function(t,e,i,s){this.button.caretOffset=this.caret.getOffset(),t.preventDefault(),this.utils.browser("msie")&&(t.returnValue=!1),"command"==i?this.inline.format(s):"dropdown"==i?this.dropdown.show(t,e):this.button.onClickCallback(t,s,e)},onClickCallback:function(t,e,i){var s;if(this.blurClickedElement=!0,"function"==typeof e)e.call(this,i);else if("-1"!=e.search(/\./)){if(void 0===this[(s=e.split("."))[0]])return;this[s[0]][s[1]](i)}else this[e](i);this.observe.buttons(t,i)},get:function(t){return this.$toolbar.find("a.re-"+t)},setActive:function(t){this.button.get(t).addClass("redactor-act").attr("aria-pressed","true")},setInactive:function(t){this.button.get(t).removeClass("redactor-act").attr("aria-pressed","false")},setInactiveAll:function(t){(void 0===t?this.$toolbar.find("a.re-icon"):this.$toolbar.find("a.re-icon").not(".re-"+t)).removeClass("redactor-act").attr("aria-pressed","false")},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html, a.re-fullscreen").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html, a.re-fullscreen").addClass("redactor-button-disabled")},changeIcon:function(t,e){this.button.get(t).addClass("re-"+e)},removeIcon:function(t,e){this.button.get(t).removeClass("re-"+e)},setAwesome:function(t,e){this.button.get(t).removeClass("redactor-btn-image").addClass("fa "+e)},addCallback:function(e,i){var s,o;"buffer"!=e&&(s="dropdown"==i?"dropdown":"func",o=e.attr("rel"),e.on("touchstart click",p.proxy(function(t){if(e.hasClass("redactor-button-disabled"))return!1;this.button.onClick(t,o,s,i)},this)))},addDropdown:function(t,e){t.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var i=t.attr("rel"),s=(this.button.addCallback(t,"dropdown"),p('<ul class="dropdown-menu redactor-dropdown redactor-dropdown-'+ +this.uuid+" redactor-dropdown-box-"+i+'" style="display: none;">'));return t.data("dropdown",s),e&&this.dropdown.build(i,s,e),s},add:function(t,e){if(this.opts.toolbar)return this.button.isMobileUndoRedo(t)?"buffer":((t=this.button.build(t,{title:e})).addClass("redactor-btn-image"),this.$toolbar.append(p("<li>").append(t)),t)},addFirst:function(t,e){if(this.opts.toolbar)return this.button.isMobileUndoRedo(t)?"buffer":((t=this.button.build(t,{title:e})).addClass("redactor-btn-image"),this.$toolbar.prepend(p("<li>").append(t)),t)},addAfter:function(t,e,i){if(this.opts.toolbar)return this.button.isMobileUndoRedo(e)?"buffer":((e=this.button.build(e,{title:i})).addClass("redactor-btn-image"),0!==(i=this.button.get(t)).length?i.parent().after(p("<li>").append(e)):this.$toolbar.append(p("<li>").append(e)),e)},addBefore:function(t,e,i){if(this.opts.toolbar)return this.button.isMobileUndoRedo(e)?"buffer":((e=this.button.build(e,{title:i})).addClass("redactor-btn-image"),0!==(i=this.button.get(t)).length?i.parent().before(p("<li>").append(e)):this.$toolbar.append(p("<li>").append(e)),e)},remove:function(t){this.button.get(t).parent().remove()},isMobileUndoRedo:function(t){return("undo"==t||"redo"==t)&&!this.utils.isDesktop()}}},caret:function(){return{setStart:function(t){var e;this.utils.isBlock(t)?this.caret.set(t,0,t,0):(e=this.utils.createSpaceElement(),p(t).prepend(e),this.caret.setEnd(e))},setEnd:function(t){if(1==(t=t[0]||t).lastChild.nodeType)return this.caret.setAfter(t.lastChild);this.caret.set(t,1,t,1)},set:function(t,e,i,s){var o;t=t[0]||t,i=i[0]||i,this.utils.isBlockTag(t.tagName)&&""===t.innerHTML&&(t.innerHTML=this.opts.invisibleSpace),"BR"==t.tagName&&!1===this.opts.linebreaks&&(o=p(this.opts.emptyHtml)[0],p(t).replaceWith(o),i=t=o),this.selection.get();try{this.range.setStart(t,e),this.range.setEnd(i,s)}catch(t){}this.selection.addRange()},setAfter:function(e){try{var t=p(e)[0].tagName;"BR"==t||this.utils.isBlock(e)?"BR"!=t&&this.utils.browser("msie")?this.caret.setStart(p(e).next()):this.caret.setAfterOrBefore(e,"after"):(i=this.utils.createSpaceElement(),p(e).after(i),this.caret.setEnd(i))}catch(t){var i=this.utils.createSpaceElement();p(e).after(i),this.caret.setEnd(i)}},setBefore:function(t){this.utils.isBlock(t)?this.caret.setEnd(p(t).prev()):this.caret.setAfterOrBefore(t,"before")},setAfterOrBefore:function(t,e){if(this.utils.browser("msie")||this.$editor.focus(),t=t[0]||t,this.selection.get(),"after"==e)try{this.range.setStartAfter(t),this.range.setEndAfter(t)}catch(t){}else try{this.range.setStartBefore(t),this.range.setEndBefore(t)}catch(t){}this.range.collapse(!1),this.selection.addRange()},getOffsetOfElement:function(t){t=t[0]||t,this.selection.get();var e=this.range.cloneRange();return e.selectNodeContents(t),e.setEnd(this.range.endContainer,this.range.endOffset),e.toString().trim().length},getOffset:function(){var t,e,i=0;return 0<window.getSelection().rangeCount&&((e=(t=window.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(this.$editor[0]),e.setEnd(t.endContainer,t.endOffset),i=e.toString().length),i},setOffset:function(t,e){void 0===e&&(e=t),this.focus.isFocused()||this.focus.setStart();this.selection.get();for(var i,s=0,o=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);i==o.nextNode();)if(t<(s+=i.nodeValue.length)&&(this.range.setStart(i,i.nodeValue.length+t-s),t=1/0),e<=s){this.range.setEnd(i,i.nodeValue.length+e-s);break}this.range.collapse(!1),this.selection.addRange()},setToPoint:function(t,e){this.caret.setOffset(t,e)},getCoords:function(){return this.caret.getOffset()}}},clean:function(){return{onSet:function(t){t=(t=(t=(t=this.clean.savePreCode(t)).replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>')).replace(/\$/g,"&#36;")).replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">'),this.opts.replaceDivs&&(t=this.clean.replaceDivs(t)),this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),t=this.clean.saveFormTags(t);var e=p("<div>"),i=(e.html(t),e.find("font[style]"));return 0!==i.length&&(i.replaceWith(function(){var t=p(this);return p("<span>").attr("style",t.attr("style")).append(t.contents())}),t=e.html()),e.remove(),t=(t=t.replace(/<font(.*?[^<])>/gi,"")).replace(/<\/font>/gi,""),t=this.tidy.load(t),this.opts.paragraphize&&(t=this.paragraphize.load(t)),t=this.clean.setVerified(t),t=(t=this.clean.convertInline(t)).replace(/&amp;/g,"&")},onSync:function(i){if(i=(i=i.replace(/\u200B/g,"")).replace(/&#x200b;/gi,""),-1!=(i=this.opts.cleanSpaces?i.replace(/&nbsp;/gi," "):i).search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i))return"";i=i.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2<\/script>"),i=this.clean.restoreFormTags(i);p.each({"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"},function(t,e){i=i.replace(new RegExp(t,"g"),e)}),i=(i=(i=(i=(i=this.utils.browser("mozilla")?i.replace(/<br\s?\/?>$/gi,""):i).replace(new RegExp("<br\\s?/?></li>","gi"),"</li>")).replace(new RegExp("</li><br\\s?/?>","gi"),"</li>")).replace(/<div(.*?[^>]) data-tagblock="redactor"(.*?[^>])>/gi,"<div$1$2>")).replace(/<(.*?) data-verified="redactor"(.*?[^>])>/gi,"<$1$2>");var t=p("<div/>").html(p.parseHTML(i,document,!0));return t.find("span").removeAttr("rel"),t.find("pre .redactor-invisible-space").each(function(){p(this).contents().unwrap()}),i=(i=(i=(i=(i=(i=(i=(i=(i=t.html()).replace(/<img(.*?[^>])rel="([^"]*?)"(.*?[^>])>/gi,"<img$1$3>")).replace(/<span class="redactor-invisible-space">(.*?)<\/span>/gi,"$1")).replace(/ data-save-url="(.*?[^>])"/gi,"")).replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>")).replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<font(.*?[^<])>/gi,"")).replace(/<\/font>/gi,""),i=this.tidy.load(i),i=(i=(i=(i=(i=this.opts.linkNofollow?(i=i.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>")).replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">'):i).replace(/\sdata-redactor-(tag|class|style)="(.*?[^>])"/gi,"")).replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>")).replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>")).replace(/&amp;/g,"&")},onPaste:function(t,e){if(t=(t=(t=(t=(t=(t=t.trim()).replace(/\$/g,"&#36;")).replace(/<span class="s[0-9]">/gi,"<span>")).replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," ")).replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"\t")).replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," "),this.opts.pastePlainText)return this.clean.getPlainText(t);if(!this.utils.isSelectAll()&&void 0===e){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"]))return this.clean.getPlainText(t,!1);if(this.utils.isCurrentOrParent("PRE"))return t=(t=(t=(t=t.replace(/”/g,'"')).replace(/“/g,'"')).replace(/‘/g,"'")).replace(/’/g,"'"),this.clean.getPreCode(t);var i;if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"]))return t=this.clean.getOnlyImages(t),this.utils.browser("msie")||(i=this.selection.getBlock())&&"P"==i.tagName&&(t=t.replace(/<img(.*?)>/gi,"<p><img$1></p>")),t;if(this.utils.isCurrentOrParent(["TD"]))return t=this.clean.onPasteTidy(t,"td"),this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),t=this.clean.replaceDivsToBr(t);if(this.utils.isCurrentOrParent(["LI"]))return this.clean.onPasteTidy(t,"li")}return t=this.clean.isSingleLine(t,e),this.clean.singleLine||(this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),this.opts.replaceDivs&&(t=this.clean.replaceDivs(t)),t=this.clean.saveFormTags(t)),t=this.clean.onPasteWord(t),t=this.clean.onPasteExtra(t),t=this.clean.onPasteTidy(t,"all"),!this.clean.singleLine&&this.opts.paragraphize&&(t=this.paragraphize.load(t)),t=this.clean.removeDirtyStyles(t),t=this.clean.onPasteRemoveSpans(t),t=this.clean.onPasteRemoveEmpty(t),t=this.clean.convertInline(t)},onPasteWord:function(t){var n,l,c,h;return(t=(t=(t=t.replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"")).replace(/<o\:p[^>]*>[\s\S]*?<\/o\:p>/gi,"")).match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)&&(t=(t=(t=(t=(t=t.replace(/<!--[\s\S]+?-->/gi,"")).replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,"")).replace(/<(\/?)s>/gi,"<$1strike>")).replace(/ /gi," ")).replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(t,e){return 0<e.length?e.replace(/./," ").slice(Math.floor(e.length/2)).split("").join(" "):""}),t=(t=(t=this.clean.onPasteIeFixLinks(t)).replace(/<img(.*?)v:shapes=(.*?)>/gi,"")).replace(/src="file\:\/\/(.*?)"/,'src=""'),n=p("<div/>").html(t),l=!1,c=1,h=[],n.find("p[style]").each(function(){var t=p(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(t){var e=parseInt(t[1]),i=parseInt(t[2]),s=p(this).html().match(/^[\w]+\./)?"ol":"ul",t=p("<li/>").html(p(this).html());if(t.html(t.html().replace(/^([\w\.]+)</,"<")),t.find("span:first").remove(),1==i&&-1==p.inArray(e,h)){var o=p("<"+s+"/>").attr({"data-level":i,"data-list":e}).html(t);p(this).replaceWith(o),l=e,h.push(e)}else{if(c<i){for(var r=n.find('[data-level="'+c+'"][data-list="'+l+'"]'),a=c;a<i;a++)(o=p("<"+s+"/>")).appendTo(r.find("li").last()),r=o;r.attr({"data-level":i,"data-list":e}).html(t)}else n.find('[data-level="'+i+'"][data-list="'+e+'"]').last().append(t);c=i,l=e,p(this).remove()}}}),n.find("[data-level][data-list]").removeAttr("data-level data-list"),t=(t=(t=(t=(t=(t=(t=(t=n.html()).replace(/·/g,"")).replace(/<p class="Mso(.*?)"/gi,"<p")).replace(/ class=\"(mso[^\"]*)\"/gi,"")).replace(/ class=(mso\w+)/gi,"")).replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2")).replace(/\n/g," ")).replace(/<p>\n?<li>/gi,"<li>")),t},onPasteExtra:function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">')).replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">')).replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">')).replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">')).replace(/<img>/gi,"")).replace(/\n{3,}/gi,"\n")).replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2")).replace(/<img(.*?)src="data:(.*?)>/gi,"")).replace(/<p><p>/gi,"<p>")).replace(/<\/p><\/p>/gi,"</p>")).replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>")).replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>")).replace(/<\/p>\s<p/gi,"</p><p")).replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,"")).replace(/<p>•([\w\W]*?)<\/p>/gi,"<li>$1</li>"),t=this.utils.browser("mozilla")?t.replace(/<br\s?\/?>$/gi,""):t},onPasteTidy:function(t,e){var i=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"],s=!1,o=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]],e=("all"==e?(s=["p","span","h1","h2","h3","h4","h5","h6"],o=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]):"td"==e?i=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]:"li"==e&&(i=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]),{deniedTags:this.opts.deniedTags||!1,allowedTags:this.opts.allowedTags||i,removeComments:!0,removePhp:!0,removeAttr:this.opts.removeAttr||!1,allowedAttr:this.opts.allowedAttr||o,removeEmpty:s});return this.tidy.load(t,e)},onPasteRemoveEmpty:function(t){return t=t.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,""),t=this.opts.linebreaks?t:t.replace(/<br>$/i,"")},onPasteRemoveSpans:function(t){return t=(t=t.replace(/<span>(.*?)<\/span>/gi,"$1")).replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," ")},onPasteIeFixLinks:function(t){return t=this.utils.browser("msie")&&0===t.trim().search(/^<a(.*?)>(.*?)<\/a>$/i)?t.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2"):t},isSingleLine:function(t,e){var i;return this.clean.singleLine=!1,this.utils.isSelectAll()||void 0!==e||(e=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|",""),e=t.match(new RegExp("</("+e+")>","gi")),i=t.match(/<\/(p|div)>/gi),e)||!(null===i||i&&i.length<=1)||t.match(/<br\s?\/?>/gi)||(this.clean.singleLine=!0,t=t.replace(/<\/?(p|div)(.*?)>/gi,"")),t},stripTags:function(t,i){i=(((i||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return t.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(t,e){return-1<i.indexOf("<"+e.toLowerCase()+">")?t:""})},savePreCode:function(t){return t=this.clean.savePreFormatting(t),t=this.clean.saveCodeFormatting(t),t=this.clean.restoreSelectionMarker(t)},savePreFormatting:function(s){var t=s.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==t&&p.each(t,p.proxy(function(t,e){var i=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);i[2]=i[2].replace(/<br\s?\/?>/g,"\n"),i[2]=i[2].replace(/&nbsp;/g," "),this.opts.preSpaces&&(i[2]=i[2].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),i[2]=this.clean.encodeEntities(i[2]),i[2]=i[2].replace(/\$/g,"&#36;"),s=s.replace(e,"<pre"+i[1]+">"+i[2]+"</pre>")},this)),s},saveCodeFormatting:function(s){var t=s.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);return null!==t&&p.each(t,p.proxy(function(t,e){var i=e.match(/<code(.*?)>([\w\W]*?)<\/code>/i);i[2]=i[2].replace(/&nbsp;/g," "),i[2]=this.clean.encodeEntities(i[2]),i[2]=i[2].replace(/\$/g,"&#36;"),s=s.replace(e,"<code"+i[1]+">"+i[2]+"</code>")},this)),s},restoreSelectionMarker:function(t){return t=t.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot; data-verified=&quot;redactor&quot;&gt;​&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker" data-verified="redactor">​</span>')},getTextFromHtml:function(t){t=t.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var e=document.createElement("div");return e.innerHTML=t,(t=e.textContent||e.innerText).trim()},getPlainText:function(t,e){return t=(t=this.clean.getTextFromHtml(t)).replace(/\n/g,"<br />"),t=this.opts.paragraphize&&void 0===e&&!this.utils.browser("mozilla")?this.paragraphize.load(t):t},getPreCode:function(t){return t=(t=t.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>")).replace(/<img(.*?)>/gi,"&lt;img$1&gt;"),t=this.clean.getTextFromHtml(t),this.opts.preSpaces&&(t=t.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),t=this.clean.encodeEntities(t)},getOnlyImages:function(t){return t=(t=(t=t.replace(/<img(.*?)>/gi,"[img$1]")).replace(/<([Ss]*?)>/gi,"")).replace(/\[img(.*?)\]/gi,"<img$1>")},getOnlyLinksAndImages:function(t){return t=(t=(t=(t=(t=t.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]')).replace(/<img(.*?)>/gi,"[img$1]")).replace(/<(.*?)>/gi,"")).replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>')).replace(/\[img(.*?)\]/gi,"<img$1>")},encodeEntities:function(t){return(t=String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},removeDirtyStyles:function(t){var e;return this.utils.browser("msie")||((e=document.createElement("div")).innerHTML=t,this.clean.clearUnverifiedRemove(p(e)),t=e.innerHTML,p(e).remove()),t},clearUnverified:function(){var t;this.utils.browser("msie")||(this.clean.clearUnverifiedRemove(this.$editor),(t=this.$editor.find("h1, h2, h3, h4, h5, h6")).find("span").removeAttr("style"),t.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),this.code.sync())},clearUnverifiedRemove:function(t){t.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),t.find("span").not('[data-verified="redactor"]').removeAttr("style"),t.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(t,e){e=p(e);e.attr("style",e.attr("rel"))})},cleanEmptyParagraph:function(){},setVerified:function(t){if(!this.utils.browser("msie")){var e=(t=(t=t.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">')).replace(new RegExp("<span(.*?[^>])>","gi"),'<span$1 data-verified="redactor">')).match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(e)for(var i=e.length,s=0;s<i;s++)try{var o=e[s].replace(/style="(.*?)"/i,'style="$1" rel="$1"');t=t.replace(e[s],o)}catch(t){}}return t},convertInline:function(t){var e=p("<div />").html(t),i=this.opts.inlineTags;return i.push("span"),e.find(i.join(",")).each(function(){var t=p(this),e=this.tagName.toLowerCase();t.attr("data-redactor-tag",e),"span"==e&&(t.attr("style")?t.attr("data-redactor-style",t.attr("style")):t.attr("class")&&t.attr("data-redactor-class",t.attr("class")))}),t=e.html(),e.remove(),t},normalizeLists:function(){this.$editor.find("li").each(function(t,e){var i=p(e).next();0===i.length||"UL"!=i[0].tagName&&"OL"!=i[0].tagName||p(e).append(i)})},removeSpaces:function(t){return t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g," ")).replace(/[\s\n]*$/g," ")).replace(/>\s{2,}</g,"> <")).replace(/\n\n/g,"\n")).replace(/\u200B/g,"")},replaceDivs:function(t){return t=(t=(t=this.opts.linebreaks?(t=t.replace(/<div><br\s?\/?><\/div>/gi,"<br />")).replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />"):t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>")).replace(/<div(.*?[^>])>/gi,"")).replace(/<\/div>/gi,"")},replaceDivsToBr:function(t){return t=(t=(t=t.replace(/<div\s(.*?)>/gi,"<p>")).replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />")).replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />")},replaceParagraphsToBr:function(t){return t=(t=(t=(t=t.replace(/<p\s(.*?)>/gi,"<p>")).replace(/<p><br\s?\/?><\/p>/gi,"<br />")).replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />")).replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")},saveFormTags:function(t){return t.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(t){return t.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},code:function(){return{set:function(t){t=t.toString().trim(),t=this.clean.onSet(t),this.utils.browser("msie")&&(t=t.replace(/<span(.*?)id="selection-marker-(1|2)"(.*?)><\/span>;/gi,"")),this.$editor.html(t),this.code.sync(),""!==t&&this.placeholder.remove(),setTimeout(p.proxy(this.buffer.add,this),15),!1===this.start&&this.observe.load()},get:function(){var t=this.$textarea.val();return this.opts.replaceDivs&&(t=this.clean.replaceDivs(t)),this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),t=this.tabifier.get(t)},sync:function(){setTimeout(p.proxy(this.code.startSync,this),10)},startSync:function(){var i=this.$editor.html();this.code.syncCode&&this.code.syncCode==i||(this.code.syncCode=i,i=this.core.setCallback("syncBefore",i),i=this.clean.onSync(i),this.$textarea.val(i),this.core.setCallback("sync",i),!1===this.start&&this.core.setCallback("change",i),this.start=!1,0==this.autosave.html&&(this.autosave.html=this.code.get()),this.opts.codemirror&&this.$textarea.next(".CodeMirror").each(function(t,e){e.CodeMirror.setValue(i)}),this.autosave.onChange(),this.autosave.enable())},toggle:function(){this.opts.visual?this.code.showCode():this.code.showVisual()},showCode:function(){this.selection.save(),this.code.offset=this.caret.getOffset();var t,e=p(window).scrollTop(),i=(this.$editor.innerWidth(),this.$editor.innerHeight()),s=(this.$editor.hide(),this.$textarea.val()),o=(this.modified=this.clean.removeSpaces(s),s=this.tabifier.get(s),0),r=0,a=p("<div/>").append(p.parseHTML(this.clean.onSync(this.$editor.html()),document,!0)),n=a.find("span.redactor-selection-marker");0<n.length&&(t=this.tabifier.get(a.html()).replace(/&amp;/g,"&"),1==n.length?(o=this.utils.strpos(t,a.find("#selection-marker-1").prop("outerHTML")),r=o):2==n.length&&(o=this.utils.strpos(t,a.find("#selection-marker-1").prop("outerHTML")),r=this.utils.strpos(t,a.find("#selection-marker-2").prop("outerHTML"))-a.find("#selection-marker-1").prop("outerHTML").toString().length)),this.selection.removeMarkers(),this.$textarea.val(s),this.opts.codemirror?this.$textarea.next(".CodeMirror").each(function(t,e){p(e).show(),e.CodeMirror.setValue(s),e.CodeMirror.setSize("100%",i),e.CodeMirror.refresh(),o==r?e.CodeMirror.setCursor(e.CodeMirror.posFromIndex(o).line,e.CodeMirror.posFromIndex(r).ch):e.CodeMirror.setSelection({line:e.CodeMirror.posFromIndex(o).line,ch:e.CodeMirror.posFromIndex(o).ch},{line:e.CodeMirror.posFromIndex(r).line,ch:e.CodeMirror.posFromIndex(r).ch}),e.CodeMirror.focus()}):(this.$textarea.height(i).show().focus(),this.$textarea.on("keydown.redactor-textarea-indenting",this.code.textareaIndenting),p(window).scrollTop(e),this.$textarea[0].setSelectionRange&&this.$textarea[0].setSelectionRange(o,r),this.$textarea[0].scrollTop=0),this.opts.visual=!1,this.button.setInactiveInCode(),this.button.setActive("html"),this.core.setCallback("source",s)},showVisual:function(){var i,s,o,t,r;this.opts.visual||(o=s=0,this.opts.codemirror?this.$textarea.next(".CodeMirror").each(function(t,e){i=e.CodeMirror.listSelections(),s=e.CodeMirror.indexFromPos(i[0].anchor),o=e.CodeMirror.indexFromPos(i[0].head),r=e.CodeMirror.getValue()}):(s=this.$textarea.get(0).selectionStart,o=this.$textarea.get(0).selectionEnd,r=this.$textarea.hide().val()),o<s&&0<o&&(t=s,s=o,o=t),s=this.code.enlargeOffset(r,s),o=this.code.enlargeOffset(r,o),r=r.substr(0,s)+this.selection.getMarkerAsHtml(1)+r.substr(s),s<o&&(t=this.selection.getMarkerAsHtml(1).toString().length,r=r.substr(0,o+t)+this.selection.getMarkerAsHtml(2)+r.substr(o+t)),this.modified!==this.clean.removeSpaces(r)&&this.code.set(r),this.opts.codemirror&&this.$textarea.next(".CodeMirror").hide(),this.$editor.show(),this.utils.isEmpty(r)||this.placeholder.remove(),this.selection.restore(),this.$textarea.off("keydown.redactor-textarea-indenting"),this.button.setActiveInVisual(),this.button.setInactive("html"),this.observe.load(),this.opts.visual=!0,this.core.setCallback("visual",r))},textareaIndenting:function(t){var e;return 9!==t.keyCode||(e=(t=this.$textarea).get(0).selectionStart,t.val(t.val().substring(0,e)+"\t"+t.val().substring(t.get(0).selectionEnd)),t.get(0).selectionStart=t.get(0).selectionEnd=e+1,!1)},enlargeOffset:function(t,e){var i=t.length,s=0;if(">"==t[e])s++;else for(var o=e;o<=i&&(s++,">"!=t[o]);o++)if("<"==t[o]||o==i){s=0;break}return e+s}}},core:function(){return{getObject:function(){return p.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},getTextarea:function(){return this.$textarea},getToolbar:function(){return this.$toolbar||!1},addEvent:function(t){this.core.event=t},getEvent:function(){return this.core.event},setCallback:function(t,s,e){var t=t+"Callback",i=this.opts[t];if(this.$textarea){var o=!1,r=p._data(this.$textarea[0],"events");if(void 0!==r&&void 0!==r[t]&&p.each(r[t],p.proxy(function(t,e){var i;"redactor"==e.namespace&&(o=void 0===(i=void 0===i?[s]:[s,i])?e.handler.call(this,s):e.handler.call(this,s,i))},this)),o)return o}return"function"==typeof i?void 0===e?i.call(this,s):i.call(this,s,e):void 0===e?s:e},destroy:function(){this.opts.destroyed=!0,this.core.setCallback("destroy"),this.$element.off(".redactor").removeData("redactor"),this.$editor.off(".redactor"),p(document).off("mousedown.redactor."+this.uuid),p(document).off("click.redactor-image-delete."+this.uuid),p(document).off("click.redactor-image-resize-hide."+this.uuid),p(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),p("body").off("scroll.redactor."+this.uuid),p(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid),this.$editor.removeClass("redactor-editor redactor-linebreaks redactor-placeholder"),this.$editor.removeAttr("contenteditable");var t=this.code.get();this.opts.toolbar&&this.$toolbar.find("a").each(function(){var t=p(this);t.data("dropdown")&&(t.data("dropdown").remove(),t.data("dropdown",{}))}),(this.build.isTextarea()?(this.$box.after(this.$element),this.$box.remove(),this.$element.val(t)):(this.$box.after(this.$editor),this.$box.remove(),this.$element.html(t))).show(),this.$pasteBox&&this.$pasteBox.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),p(".redactor-toolbar-tooltip-"+this.uuid).remove(),clearInterval(this.autosaveInterval)}}},dropdown:function(){return{build:function(e,i,o){"formatting"==e&&this.opts.formattingAdd&&p.each(this.opts.formattingAdd,p.proxy(function(t,e){var i,s=e.tag;void 0!==e.class&&(s=s+"-"+e.class),e.type=this.utils.isBlockTag(e.tag)?"block":"inline",i=void 0!==e.func?e.func:"inline"==e.type?"inline.formatting":"block.formatting",this.opts.linebreaks&&"block"==e.type&&"p"==e.tag||(this.formatting[s]={tag:e.tag,style:e.style,class:e.class,attr:e.attr,data:e.data,clear:e.clear},o[s]={func:i,title:e.title})},this)),p.each(o,p.proxy(function(s,o){var t="",t=(o.className&&(t=o.className),p('<li><a href="#" class="'+t+" redactor-dropdown-"+s+'">'+o.title+"</a></li>"));"formatting"==e&&t.addClass("redactor-formatting-"+s),t.on("click",p.proxy(function(t){t.preventDefault();var e="func",i=o.func;o.command?(e="command",i=o.command):o.dropdown&&(e="dropdown",i=o.dropdown),p(t.target).hasClass("redactor-dropdown-link-inactive")||(this.button.onClick(t,s,e,i),this.dropdown.hideAll())},this)),this.observe.addDropdown(t,s,o),i.append(t)},this))},show:function(t,e){if(!this.opts.visual)return t.preventDefault(),!1;var i,s,o,r,a=this.button.get(e),n=(0==p("#redactor-dropdown-holder").length&&p(document.body).append('<div id="redactor-dropdown-holder" class="ccm-ui" />'),p("#redactor-dropdown-holder")),n=a.data("dropdown").appendTo(n);this.opts.highContrast&&n.addClass("redactor-dropdown-contrast"),a.hasClass("dropact")?this.dropdown.hideAll():(this.dropdown.hideAll(),this.observe.dropdowns(),this.core.setCallback("dropdownShow",{dropdown:n,key:e,button:a}),this.button.setActive(e),a.addClass("dropact"),i=a.offset(),s=n.width(),i.left+s>p(document).width()&&(i.left=Math.max(0,i.left-s)),s=i.left+"px",(this.$toolbar.hasClass("toolbar-fixed-box")?(r=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,o="fixed",this.opts.toolbarFixedTarget!==document&&(r=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,o="absolute"),n.css({position:o,left:s,top:r+"px"})):(r=a.innerHeight()+i.top+"px",n.css({position:"absolute",left:s,top:r}))).show(),this.core.setCallback("dropdownShown",{dropdown:n,key:e,button:a}),this.$dropdown=n),p(document).one("click.redactor-dropdown",p.proxy(this.dropdown.hide,this)),this.$editor.one("click.redactor-dropdown",p.proxy(this.dropdown.hide,this)),p(document).one("keyup.redactor-dropdown",p.proxy(this.dropdown.closeHandler,this)),n.on("mouseover.redactor-dropdown",p.proxy(this.utils.disableBodyScroll,this)).on("mouseout.redactor-dropdown",p.proxy(this.utils.enableBodyScroll,this)),t.stopPropagation()},closeHandler:function(t){t.which==this.keyCode.ESC&&(this.dropdown.hideAll(),this.$editor.focus())},hideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor-act").removeClass("dropact"),this.utils.enableBodyScroll(),p(".redactor-dropdown-"+this.uuid).hide(),p(".redactor-dropdown-link-selected").removeClass("redactor-dropdown-link-selected"),this.$dropdown&&(this.$dropdown.off(".redactor-dropdown"),this.core.setCallback("dropdownHide",this.$dropdown),this.$dropdown=!1)},hide:function(t){t=p(t.target);t.hasClass("dropact")||t.hasClass("redactor-dropdown-link-inactive")||(t.removeClass("dropact"),t.off("mouseover mouseout"),this.dropdown.hideAll())}}},file:function(){return{show:function(){this.modal.load("file",this.lang.get("file"),700),this.modal.createCancelButton(),this.file.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.opts.concrete5.filemanager?p("a[data-action=choose-image-from-file-manager]").on("click",function(t){t.preventDefault(),ConcreteFileManager.launchDialog(function(t){jQuery.fn.dialog.showLoader(),ConcreteFileManager.getFileDetails(t.fID,function(t){jQuery.fn.dialog.hideLoader();t=t.files[0];p("#redactor-file-link").val(t.urlDownload)})})}):p("a[data-action=choose-image-from-file-manager]").remove(),this.file.buttonSave.on("click",p.proxy(function(){var t,e=p("#redactor-file-link").val();""!==e?(t=p("#redactor-filename").val(),this.file.insert('<a href="'+e+'" id="filelink-marker">'+t+"</a>",!1)):this.modal.close()},this)),this.selection.save(),this.selection.get();var t=this.sel.toString();p("#redactor-filename").val(t),this.modal.show()},insert:function(t,e,i){var s;void 0!==t.error?(this.modal.close(),this.selection.restore(),this.core.setCallback("fileUploadError",t)):(s="string"==typeof t?t:(void 0!==(s=p("#redactor-filename").val())&&""!==s||(s=t.filename),'<a href="'+t.filelink+'" id="filelink-marker">'+s+"</a>"),e?(this.selection.removeMarkers(),e=this.selection.getMarker(),this.insert.nodeToCaretPositionFromPoint(i,e)):this.modal.close(),this.selection.restore(),this.buffer.set(),this.insert.htmlWithoutClean(s),"string"!=typeof t&&(0!==(i=p(this.$editor.find("a#filelink-marker"))).length?i.removeAttr("id").removeAttr("style"):i=!1,this.core.setCallback("fileUpload",i,t)))}}},focus:function(){return{setStart:function(){this.$editor.focus();var t=this.$editor.children().first();if(0!==t.length&&0!==t[0].length&&"BR"!=t[0].tagName&&3!=t[0].nodeType){if("UL"==t[0].tagName||"OL"==t[0].tagName){var e=t.find("li").first();if(!this.utils.isBlock(e)&&""===e.text())return void this.caret.setStart(e)}this.opts.linebreaks&&!this.utils.isBlockTag(t[0].tagName)?(this.selection.get(),this.range.setStart(this.$editor[0],0),this.range.setEnd(this.$editor[0],0),this.selection.addRange()):this.caret.setStart(t)}},setEnd:function(){var t=this.$editor.children().last();this.$editor.focus(),0!==t.size()&&(this.utils.isEmpty(this.$editor.html())?(this.selection.get(),this.range.collapse(!0),this.range.setStartAfter(t[0]),this.range.setEnd(t[0],0)):(this.selection.get(),this.range.selectNodeContents(t[0]),this.range.collapse(!1)),this.selection.addRange())},isFocused:function(){var t=document.getSelection().focusNode;return null!==t&&(!(!this.opts.linebreaks||!p(t.parentNode).hasClass("redactor-linebreaks"))||!!this.utils.isRedactorParent(t.parentNode)&&this.$editor.is(":focus"))}}},image:function(){return{show:function(){this.modal.load("image",this.lang.get("image"),700),this.modal.createCancelButton(),this.image.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.opts.concrete5.filemanager?p("a[data-action=choose-image-from-file-manager]").on("click",function(t){t.preventDefault(),ConcreteFileManager.launchDialog(function(t){jQuery.fn.dialog.showLoader(),ConcreteFileManager.getFileDetails(t.fID,function(t){jQuery.fn.dialog.hideLoader();t=t.files[0];p("#redactor-image-link").val(t.urlInline)})})}):p("a[data-action=choose-image-from-file-manager]").remove(),this.image.buttonSave.on("click",p.proxy(function(){var t,e=p("#redactor-image-link").val();""!==e?(t="",t="<img "+(t=this.opts.concrete5.mailer?'class="image-mailer-fm" ':t)+' src="'+e+'" />',!1===this.opts.linebreaks&&(t="<p>"+t+"</p>"),this.image.insert(t,!1)):this.modal.close()},this)),this.selection.save(),this.modal.show()},showEdit:function(t){var e=t.closest("a",this.$editor[0]),i=(this.modal.load("imageEdit",this.lang.get("edit"),705),this.image.linkLightboxType="image",this.image.linkLightboxIframeWidth="600",this.image.linkLightboxIframeHeight="400",this.image.$inputUrl=p("#redactor-image-link"),e.attr("data-concrete5-link-lightbox")),s=("_blank"==e.attr("target")?this.image.linkType="blank":"image"==i||"iframe"==i?(this.image.linkType="lightbox",this.image.linkLightboxType=i,this.image.linkLightboxIframeWidth=e.attr("data-concrete5-link-lightbox-width"),this.image.linkLightboxIframeHeight=e.attr("data-concrete5-link-lightbox-height")):this.image.linkType="same",this.image.$selectUrlOpen=p("#redactor-link-url-open"),this.opts.concrete5.lightbox||this.image.$selectUrlOpen.find("option[value=lightbox]").remove(),this.image.$selectUrlLightboxFieldGroup=p("div[data-field-group=lightbox]"),this.image.$selectUrlLightboxIframeFieldGroup=p("div[data-field-group=lightbox-iframe]"),this.image.$selectUrlLightboxFieldGroupSelect=p("div[data-field-group=lightbox] select"),this.image.$selectUrlLightboxIframeWidth=p("#redactor-link-lightbox-iframe-width"),this.image.$selectUrlLightboxIframeHeight=p("#redactor-link-lightbox-iframe-height"),this.image.$selectUrlOpen.val(this.image.linkType),this.image.$selectUrlLightboxIframeWidth.val(this.image.linkLightboxIframeWidth),this.image.$selectUrlLightboxIframeHeight.val(this.image.linkLightboxIframeHeight),this.image);this.image.$selectUrlOpen.on("change",function(){"lightbox"==p(this).val()?s.$selectUrlLightboxFieldGroup.show():(s.$selectUrlLightboxFieldGroup.hide(),s.$selectUrlLightboxFieldGroupSelect.val("image").trigger("change"))}).trigger("change"),this.image.$selectUrlLightboxFieldGroupSelect.val(this.image.linkLightboxType),this.image.$selectUrlLightboxFieldGroupSelect.on("change",function(){"iframe"==p(this).val()?s.$selectUrlLightboxIframeFieldGroup.show():s.$selectUrlLightboxIframeFieldGroup.hide()}).trigger("change"),this.opts.concrete5.filemanager?p("a[data-action=choose-file-from-file-manager]").on("click",function(t){t.preventDefault(),ConcreteFileManager.launchDialog(function(t){jQuery.fn.dialog.showLoader(),ConcreteFileManager.getFileDetails(t.fID,function(t){jQuery.fn.dialog.hideLoader();t=t.files[0];s.$inputUrl.val(t.urlInline)})})}):p("a[data-action=choose-file-from-file-manager]").remove(),this.opts.concrete5.sitemap?p("a[data-action=choose-link-from-sitemap]").on("click",function(t){t.preventDefault(),jQuery.fn.dialog.open({width:"90%",height:"70%",modal:!1,title:ccmi18n_sitemap.choosePage,href:CCM_TOOLS_PATH+"/sitemap_search_selector"}),ConcreteEvent.unsubscribe("SitemapSelectPage"),ConcreteEvent.subscribe("SitemapSelectPage",function(t,e){jQuery.fn.dialog.closeTop();e=CCM_APPLICATION_URL+"/index.php?cID="+e.cID;s.$inputUrl.val(e)})}):p("a[data-action=choose-link-from-sitemap]").remove(),this.opts.concrete5.sitemap||this.opts.concrete5.filemanager||p("#redactor-image-link").parent().removeClass(),this.modal.createCancelButton(),this.image.buttonDelete=this.modal.createDeleteButton(this.lang.get("_delete")),this.image.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.image.buttonDelete.on("click",p.proxy(function(){this.image.remove(t)},this)),this.image.buttonSave.on("click",p.proxy(function(){this.image.update(t)},this)),p(".redactor-link-tooltip").remove(),p("#redactor-image-alt").val(t.attr("alt")),this.opts.imageLink?((i=p("#redactor-image-link")).attr("href",t.attr("src")),0!==e.length&&(i.val(e.attr("href")),"_blank"==e.attr("target"))&&p("#redactor-image-link-blank").prop("checked",!0)):p(".redactor-image-link-option").hide(),this.opts.imagePosition?(i="block"==t.css("display")&&"none"==t.css("float")?"center":t.css("float"),p("#redactor-image-align").val(i)):p(".redactor-image-position-option").hide(),this.modal.show(),p("#redactor-image-alt").focus()},setFloating:function(t){var e="",i="",s="";switch(p("#redactor-image-align").val()){case"left":e="left",s="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":e="right",s="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":i="block",s="auto"}t.css({float:e,display:i,margin:s}),t.attr("rel",t.attr("style"))},update:function(t){this.image.hideResize(),this.buffer.set();var e,i,s,o,r,a=t.closest("a",this.$editor[0]),n=p("#redactor-image-alt").val().replace(/(<([^>]+)>)/gi,""),n=(t.attr("alt",n),this.image.setFloating(t),p("#redactor-image-link").val().trim());""!==(n=n.replace(/(<([^>]+)>)/gi,""))?(r="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",e=new RegExp("^(http|ftp|https)://"+r,"i"),r=new RegExp("^"+r,"i"),-1==n.search(e)&&0===n.search(r)&&this.opts.linkProtocol&&(n=this.opts.linkProtocol+"://"+n),e=!1,"blank"==p("#redactor-link-url-open").val()&&(e=!0),"lightbox"==p("#redactor-link-url-open").val()&&"iframe"==(i=p("#redactor-link-lightbox-type").val())&&(s=p("#redactor-link-lightbox-iframe-width").val(),o=p("#redactor-link-lightbox-iframe-height").val()),0===a.length?(r=p('<a href="'+n+'">'+this.utils.getOuterHtml(t)+"</a>"),e&&r.attr("target","_blank"),i&&(r.attr("data-concrete5-link-lightbox",i),"iframe"==i)&&s&&o&&(r.attr("data-concrete5-link-lightbox-width",s),r.attr("data-concrete5-link-lightbox-height",o)),t.replaceWith(r)):(a.removeAttr("data-concrete5-link-lightbox"),a.removeAttr("data-concrete5-link-lightbox-width"),a.removeAttr("data-concrete5-link-lightbox-height"),a.attr("href",n),e?a.attr("target","_blank"):a.removeAttr("target"),i&&(a.attr("data-concrete5-link-lightbox",i),"iframe"==i)&&s&&o&&(a.attr("data-concrete5-link-lightbox-width",s),a.attr("data-concrete5-link-lightbox-height",o)))):0!==a.length&&a.replaceWith(this.utils.getOuterHtml(t)),this.modal.close(),this.observe.images(),this.code.sync()},setEditable:function(e){this.opts.imageEditable&&e.on("dragstart",p.proxy(this.image.onDrag,this));var t=p.proxy(function(t){this.observe.image=e,this.image.resizer=this.image.loadEditableControls(e),p(document).on("mousedown.redactor-image-resize-hide."+this.uuid,p.proxy(this.image.hideResize,this)),this.opts.imageResizable&&this.image.resizer.on("mousedown.redactor touchstart.redactor",p.proxy(function(t){this.image.setResizable(t,e)},this))},this);e.off("mousedown.redactor").on("mousedown.redactor",p.proxy(this.image.hideResize,this)),e.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",t)},setResizable:function(t,e){t.preventDefault(),this.image.resizeHandle={x:t.pageX,y:t.pageY,el:e,ratio:e.width()/e.height(),h:e.height()},(t=t.originalEvent||t).targetTouches&&(this.image.resizeHandle.x=t.targetTouches[0].pageX,this.image.resizeHandle.y=t.targetTouches[0].pageY),this.image.startResize()},startResize:function(){p(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",p.proxy(this.image.moveResize,this)),p(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",p.proxy(this.image.stopResize,this))},moveResize:function(t){t.preventDefault(),t=t.originalEvent||t;var e=this.image.resizeHandle.h,t=(t.targetTouches?e+=t.targetTouches[0].pageY-this.image.resizeHandle.y:e+=t.pageY-this.image.resizeHandle.y,Math.round(e*this.image.resizeHandle.ratio));e<50||t<100||(e=Math.round(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio),this.image.resizeHandle.el.attr({width:t,height:e}),this.image.resizeHandle.el.width(t),this.image.resizeHandle.el.height(e),this.code.sync())},stopResize:function(){this.handle=!1,p(document).off(".redactor-image-resize"),this.image.hideResize()},onDrag:function(t){if(0!==this.$editor.find("#redactor-image-box").length)return t.preventDefault(),!1;this.$editor.on("drop.redactor-image-inside-drop",p.proxy(function(){setTimeout(p.proxy(this.image.onDrop,this),1)},this))},onDrop:function(){this.image.fixImageSourceAfterDrop(),this.observe.images(),this.$editor.off("drop.redactor-image-inside-drop"),this.clean.clearUnverified(),this.code.sync()},fixImageSourceAfterDrop:function(){this.$editor.find("img[data-save-url]").each(function(){var t=p(this);t.attr("src",t.attr("data-save-url")),t.removeAttr("data-save-url")})},hideResize:function(t){t&&0!==p(t.target).closest("#redactor-image-box",this.$editor[0]).length||(t&&"IMG"==t.target.tagName&&(t=p(t.target)).attr("data-save-url",t.attr("src")),0!==(t=this.$editor.find("#redactor-image-box")).length&&(p("#redactor-image-editter").remove(),p("#redactor-image-resizer").remove(),t.find("img").css({marginTop:t[0].style.marginTop,marginBottom:t[0].style.marginBottom,marginLeft:t[0].style.marginLeft,marginRight:t[0].style.marginRight}),t.css("margin",""),t.find("img").css("opacity",""),t.replaceWith(function(){return p(this).contents()}),p(document).off("mousedown.redactor-image-resize-hide."+this.uuid),void 0!==this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")),this.code.sync()))},loadResizableControls:function(t,e){var i;return this.opts.imageResizable&&!this.utils.isMobile()?(i=p('<span id="redactor-image-resizer" data-redactor="verified"></span>'),this.utils.isDesktop()||i.css({width:"15px",height:"15px"}),i.attr("contenteditable",!1),e.append(i),e.append(t),i):(e.append(t),!1)},loadEditableControls:function(t){var e,i=p('<span id="redactor-image-box" data-redactor="verified">');return i.css("float",t.css("float")).attr("contenteditable",!1),"auto"!=t[0].style.margin?(i.css({marginTop:t[0].style.marginTop,marginBottom:t[0].style.marginBottom,marginLeft:t[0].style.marginLeft,marginRight:t[0].style.marginRight}),t.css("margin","")):i.css({display:"block",margin:"auto"}),t.css("opacity",".5").after(i),this.opts.imageEditable&&(this.image.editter=p('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",p.proxy(function(){this.image.showEdit(t)},this)),i.append(this.image.editter),e=this.image.editter.innerWidth(),this.image.editter.css("margin-left","-"+e/2+"px")),this.image.loadResizableControls(t,i)},remove:function(t){var e,t=p(t),i=t.closest("a",this.$editor[0]),s=t.closest("figure",this.$editor[0]),o=t.parent();0!==p("#redactor-image-box").length&&(o=p("#redactor-image-box").parent()),(0!==s.length?(e=s.next(),s):0!==i.length?(o=i.parent(),i):t).remove(),p("#redactor-image-box").remove(),0!==s.length?this.caret.setStart(e):this.caret.setStart(o),this.core.setCallback("imageDelete",t[0].src,t),this.modal.close(),this.code.sync()},insert:function(t,e,i){var s,o,r;void 0!==t.error?(this.modal.close(),this.selection.restore(),this.core.setCallback("imageUploadError",t)):("string"==typeof t?r=p(t).attr("data-redactor-inserted-image","true"):(r=p("<img>")).attr("src",t.filelink).attr("data-redactor-inserted-image","true"),s=r,(o=this.utils.isCurrentOrParent("P"))&&(s=p("<blockquote />").append(r)),e?(this.selection.removeMarkers(),r=this.selection.getMarker(),this.insert.nodeToCaretPositionFromPoint(i,r)):this.modal.close(),this.selection.restore(),this.buffer.set(),this.insert.html(this.utils.getOuterHtml(s),!1),e=this.$editor.find("img[data-redactor-inserted-image=true]").removeAttr("data-redactor-inserted-image"),o?e.parent().contents().unwrap().wrap("<p />"):this.opts.linebreaks&&(this.utils.isEmpty(this.code.get())||e.before("<br>"),e.after("<br>")),"string"!=typeof t&&this.core.setCallback("imageUpload",e,t))}}},indent:function(){return{increase:function(){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var t=this.selection.getBlock();t&&"LI"==t.tagName?this.indent.increaseLists():!1===t&&this.opts.linebreaks?this.indent.increaseText():this.indent.increaseBlocks(),this.selection.restore(),this.code.sync()},increaseLists:function(){document.execCommand("indent"),this.indent.fixEmptyIndent(),this.clean.normalizeLists(),this.clean.clearUnverified()},increaseBlocks:function(){p.each(this.selection.getBlocks(),p.proxy(function(t,e){var i;"TD"!==e.tagName&&"TH"!==e.tagName&&(e=this.utils.getAlignmentElement(e),i=this.utils.normalize(e.css("margin-left"))+this.opts.indentValue,e.css("margin-left",i+"px"))},this))},increaseText:function(){var t=this.selection.wrap("div");p(t).attr("data-tagblock","redactor"),p(t).css("margin-left",this.opts.indentValue+"px")},decrease:function(){this.buffer.set(),this.selection.save();var t=this.selection.getBlock();t&&"LI"==t.tagName?this.indent.decreaseLists():this.indent.decreaseBlocks(),this.selection.restore(),this.code.sync()},decreaseLists:function(){document.execCommand("outdent");var t=this.selection.getCurrent(),t=p(t).closest("li",this.$editor[0]);this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==t.length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote, p").each(p.proxy(this.utils.removeEmpty,this))),this.clean.clearUnverified()},decreaseBlocks:function(){p.each(this.selection.getBlocks(),p.proxy(function(t,e){var e=this.utils.getAlignmentElement(e),i=this.utils.normalize(e.css("margin-left"))-this.opts.indentValue;i<=0?this.opts.linebreaks&&void 0!==e.data("tagblock")?e.replaceWith(e.html()+"<br />"):(e.css("margin-left",""),this.utils.removeEmptyAttr(e,"style")):e.css("margin-left",i+"px")},this))},fixEmptyIndent:function(){var t=this.selection.getBlock();this.range.collapsed&&t&&"LI"==t.tagName&&this.utils.isEmpty(p(t).text())&&((t=p(t)).find("span").not(".redactor-selection-marker").contents().unwrap(),t.append("<br>"))}}},inline:function(){return{formatting:function(t){var e,i;void 0!==this.formatting[t].style?e="style":void 0!==this.formatting[t].class&&(e="class"),e&&(i=this.formatting[t][e]),this.inline.format(this.formatting[t].tag,e,i)},format:function(t,e,i){var s=this.selection.getCurrent();if(!(s&&"TR"===s.tagName||(this.blurClickedElement=!0,this.utils.isCurrentOrParent("PRE"))||this.utils.isCurrentOrParentHeader())){for(var o=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],r=["strong","strong","em","em","u","del","del","sup","sub"],a=0;a<o.length;a++)t==o[a]&&(t=r[a]);if(this.opts.allowedTags){if(-1==p.inArray(t,this.opts.allowedTags))return}else if(-1!==p.inArray(t,this.opts.deniedTags))return;this.inline.type=e||!1,this.inline.value=i||!1,this.buffer.set(),this.utils.browser("msie")||this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(t):this.inline.formatMultiple(t)}},formatCollapsed:function(t){var e=this.selection.getCurrent(),e=p(e).closest(t+"[data-redactor-tag="+t+"]",this.$editor[0]);0!==e.length&&"style"!=this.inline.type&&"SPAN"!=e[0].tagName?this.utils.isEmpty(e.text())?(this.caret.setAfter(e[0]),e.remove(),this.code.sync()):this.utils.isEndOfElement(e)&&this.caret.setAfter(e[0]):((e=p("<"+t+">").attr("data-verified","redactor").attr("data-redactor-tag",t)).html(this.opts.invisibleSpace),e=this.inline.setFormat(e),e=this.insert.node(e),this.caret.setEnd(e),this.code.sync())},formatMultiple:function(n){var i;this.inline.formatConvert(n),this.selection.save(),document.execCommand("strikethrough"),this.$editor.find("strike").each(p.proxy(function(t,e){var i,e=p(e),s=(this.inline.formatRemoveSameChildren(e,n),i=this.inline.type?(i=p("<span>").attr("data-redactor-tag",n).attr("data-verified","redactor"),this.inline.setFormat(i)):p("<"+n+">").attr("data-redactor-tag",n).attr("data-verified","redactor"),e.replaceWith(i.html(e.contents())),i.parent());if(s&&"U"===s[0].tagName&&i.parent().replaceWith(i),"span"==n&&s&&"SPAN"===s[0].tagName&&"style"===this.inline.type)for(var o=this.inline.value.split(";"),r=0;r<o.length;r++){if(""===o[r])return;var a=o[r].split(":");s.css(a[0],""),this.utils.removeEmptyAttr(s,"style")&&s.replaceWith(s.contents())}},this)),"span"!=n&&this.$editor.find(this.opts.inlineTags.join(", ")).each(p.proxy(function(t,e){var i=p(e);"U"===e.tagName&&0===e.attributes.length?i.replaceWith(i.contents()):"line-through"===i.css("text-decoration")&&(i.css("text-decoration",""),this.utils.removeEmptyAttr(i,"style"))},this)),"del"!=n&&(i=this).$editor.find("inline").each(function(t,e){i.utils.replaceToTag(e,"del")}),this.selection.restore(),this.code.sync()},formatRemoveSameChildren:function(t,e){var o=this;t.children(e).each(function(){var t=p(this);if(!t.hasClass("redactor-selection-marker"))if("style"==o.inline.type)for(var e=o.inline.value.split(";"),i=0;i<e.length;i++){if(""===e[i])return;var s=e[i].split(":");t.css(s[0],""),o.utils.removeEmptyAttr(t,"style")&&t.replaceWith(t.contents())}else t.contents().unwrap()})},formatConvert:function(e){this.selection.save();var i="",s=("class"==this.inline.type?i='[data-redactor-class="'+this.inline.value+'"]':"style"==this.inline.type&&(i='[data-redactor-style="'+this.inline.value+'"]'),this);"del"!=e&&this.$editor.find("del").each(function(t,e){s.utils.replaceToTag(e,"inline")}),"span"!=e&&this.$editor.find(e).each(function(){var t=p(this);t.replaceWith(p("<strike />").html(t.contents()))}),this.$editor.find('[data-redactor-tag="'+e+'"]'+i).each(function(){var t;""===i&&"span"==e&&this.tagName.toLowerCase()==e||(t=p(this)).replaceWith(p("<strike />").html(t.contents()))}),this.selection.restore()},setFormat:function(t){switch(this.inline.type){case"class":t.hasClass(this.inline.value)?(t.removeClass(this.inline.value),t.removeAttr("data-redactor-class")):(t.addClass(this.inline.value),t.attr("data-redactor-class",this.inline.value));break;case"style":t[0].style.cssText=this.inline.value,t.attr("data-redactor-style",this.inline.value)}return t},removeStyle:function(){this.buffer.set();var t=this.selection.getCurrent(),e=this.selection.getInlines();this.selection.save(),t&&"SPAN"===t.tagName&&((t=p(t)).removeAttr("style"),0===t[0].attributes.length)&&t.replaceWith(t.contents()),p.each(e,p.proxy(function(t,e){var i=p(e);-1==p.inArray(e.tagName.toLowerCase(),this.opts.inlineTags)||i.hasClass("redactor-selection-marker")||(i.removeAttr("style"),0===i[0].attributes.length&&i.replaceWith(i.contents()))},this)),this.selection.restore(),this.code.sync()},removeStyleRule:function(s){this.buffer.set();var t=this.selection.getParent(),e=this.selection.getInlines();this.selection.save(),t&&"SPAN"===t.tagName&&((t=p(t)).css(s,""),this.utils.removeEmptyAttr(t,"style"),0===t[0].attributes.length)&&t.replaceWith(t.contents()),p.each(e,p.proxy(function(t,e){var i=p(e);-1==p.inArray(e.tagName.toLowerCase(),this.opts.inlineTags)||i.hasClass("redactor-selection-marker")||(i.css(s,""),this.utils.removeEmptyAttr(i,"style"),0===i[0].attributes.length&&i.replaceWith(i.contents()))},this)),this.selection.restore(),this.code.sync()},removeFormat:function(){this.buffer.set();var t=this.selection.getCurrent();this.selection.save(),document.execCommand("removeFormat"),t&&"SPAN"===t.tagName&&p(t).replaceWith(p(t).contents()),p.each(this.selection.getNodes(),p.proxy(function(t,e){var i=p(e);-1==p.inArray(e.tagName.toLowerCase(),this.opts.inlineTags)||i.hasClass("redactor-selection-marker")||i.replaceWith(i.contents())},this)),this.selection.restore(),this.code.sync()},toggleClass:function(t){this.inline.format("span","class",t)},toggleStyle:function(t){this.inline.format("span","style",t)}}},insert:function(){return{set:function(t,e){this.placeholder.remove(),t=this.clean.setVerified(t),void 0===e&&(t=this.clean.onPaste(t,!1)),this.$editor.html(t),this.selection.remove(),this.focus.setEnd(),this.clean.normalizeLists(),this.code.sync(),this.observe.load(),void 0===e&&setTimeout(p.proxy(this.clean.clearUnverified,this),10)},text:function(t){if(this.placeholder.remove(),t=(t=t.toString()).trim(),t=this.clean.getPlainText(t,!1),this.$editor.focus(),this.utils.browser("msie"))this.insert.htmlIe(t);else{this.selection.get(),this.range.deleteContents();for(var e,i,s=document.createElement("div"),o=(s.innerHTML=t,document.createDocumentFragment());e=s.firstChild;)i=o.appendChild(e);this.range.insertNode(o),i&&((t=this.range.cloneRange()).setStartAfter(i),t.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(t))}this.code.sync(),this.clean.clearUnverified()},htmlWithoutClean:function(t){this.insert.html(t,!1)},html:function(t,e){this.placeholder.remove(),void 0===e&&(e=!0),this.$editor.focus(),t=this.clean.setVerified(t),e&&(t=this.clean.onPaste(t)),this.utils.browser("msie")?this.insert.htmlIe(t):(this.clean.singleLine?this.insert.execHtml(t):document.execCommand("insertHTML",!1,t),this.insert.htmlFixMozilla()),this.clean.normalizeLists(),this.opts.linebreaks||this.$editor.find("p").each(p.proxy(this.utils.removeEmpty,this)),this.code.sync(),this.observe.load(),e&&this.clean.clearUnverified()},htmlFixMozilla:function(){var t;this.utils.browser("mozilla")&&0<(t=p(this.selection.getBlock()).next()).length&&"P"==t[0].tagName&&""===t.html()&&t.remove()},htmlIe:function(t){var e,i;this.utils.isIe11()?(e=this.utils.isCurrentOrParent("P"),i=p("<div>").append(t).contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article"),e&&i?this.insert.ie11FixInserting(e,t):this.insert.ie11PasteFrag(t)):document.selection.createRange().pasteHTML(t)},execHtml:function(t){t=this.clean.setVerified(t),this.selection.get(),this.range.deleteContents();for(var e,i,s=document.createElement("div"),o=(s.innerHTML=t,document.createDocumentFragment());e=s.firstChild;)i=o.appendChild(e);this.range.insertNode(o),this.range.collapse(!0),this.caret.setAfter(i)},node:function(t,e){t=t[0]||t;var i=this.utils.getOuterHtml(t);return null!==(i=this.clean.setVerified(i)).match(/</g)&&(t=p(i)[0]),this.selection.get(),!1!==e&&this.range.deleteContents(),this.range.insertNode(t),this.range.collapse(!1),this.selection.addRange(),t},nodeToPoint:function(t,e,i){var s,o;t=t[0]||t,this.selection.get(),document.caretPositionFromPoint?(o=document.caretPositionFromPoint(e,i),this.range.setStart(o.offsetNode,o.offset),this.range.collapse(!0),this.range.insertNode(t)):document.caretRangeFromPoint?(s=document.caretRangeFromPoint(e,i)).insertNode(t):void 0!==document.body.createTextRange&&((s=document.body.createTextRange()).moveToPoint(e,i),(o=s.duplicate()).moveToPoint(e,i),s.setEndPoint("EndToEnd",o),s.select())},nodeToCaretPositionFromPoint:function(t,e){e=e[0]||e;var i,s,o=t.clientX,t=t.clientY;document.caretPositionFromPoint?(s=document.caretPositionFromPoint(o,t),(i=document.getSelection().getRangeAt(0)).setStart(s.offsetNode,s.offset),i.collapse(!0),i.insertNode(e)):document.caretRangeFromPoint?(i=document.caretRangeFromPoint(o,t)).insertNode(e):void 0!==document.body.createTextRange&&((i=document.body.createTextRange()).moveToPoint(o,t),(s=i.duplicate()).moveToPoint(o,t),i.setEndPoint("EndToEnd",s),i.select())},ie11FixInserting:function(t,e){var i=document.createElement("span"),i=(i.className="redactor-ie-paste",this.insert.node(i),p(t).html());i=(i="<p>"+i.replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+e+"<p>")+"</p>").replace(/<p><\/p>/gi,""),p(t).replaceWith(i)},ie11PasteFrag:function(t){this.selection.get(),this.range.deleteContents();for(var e,i=document.createElement("div"),s=(i.innerHTML=t,document.createDocumentFragment());e=i.firstChild;)s.appendChild(e);this.range.insertNode(s),this.range.collapse(!1),this.selection.addRange()}}},keydown:function(){return{init:function(t){if(!this.rtePaste){var e=t.which,i=37<=e&&e<=40;if(this.keydown.ctrl=t.ctrlKey||t.metaKey,this.keydown.current=this.selection.getCurrent(),this.keydown.parent=this.selection.getParent(),this.keydown.block=this.selection.getBlock(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.shortcuts.init(t,e),this.utils.isDesktop()&&(this.keydown.checkEvents(i,e),this.keydown.setupBuffer(t,e)),this.keydown.addArrowsEvent(i),this.keydown.setupSelectAll(t,e),!1===this.core.setCallback("keydown",t))return t.preventDefault(),!1;if(!this.opts.enterKey||!this.utils.browser("msie")&&!this.utils.browser("mozilla")||e!==this.keyCode.DOWN&&e!==this.keyCode.RIGHT||(r=i=!1,(r=this.keydown.block&&"TD"===this.keydown.block.tagName?p(this.keydown.block).closest("table",this.$editor[0]):r)&&r.find("td").last()[0]===this.keydown.block&&(i=!0),this.utils.isEndOfElement()&&i&&(s=p(this.opts.emptyHtml),r.after(s),this.caret.setStart(s))),this.opts.enterKey&&e===this.keyCode.DOWN&&this.keydown.onArrowDown(),this.opts.enterKey||e!==this.keyCode.ENTER){if(e==this.keyCode.ENTER&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey){if(!1===this.core.setCallback("enter",t))return t.preventDefault(),!1;if(this.keydown.blockquote&&!0===this.keydown.exitFromBlockquote(t))return!1;if(this.keydown.pre)return this.keydown.insertNewLine(t);if(this.keydown.blockquote||this.keydown.figcaption)return o=this.selection.getCurrent(),(0===(u=p(o).next()).length||"BR"!=u[0].tagName)&&this.utils.isEndOfElement()&&o&&"SPAN"!=o?this.keydown.insertDblBreakLine(t):this.keydown.insertBreakLine(t);if(this.opts.linebreaks&&!this.keydown.block)return o=this.selection.getCurrent(),0!==(u=p(this.keydown.current).next()).length&&"BR"==u[0].tagName?this.keydown.insertBreakLine(t):!1!==o&&p(o).hasClass("redactor-invisible-space")?(this.caret.setAfter(o),p(o).contents().unwrap(),this.keydown.insertDblBreakLine(t)):this.utils.isEndOfEditor()?this.keydown.insertDblBreakLine(t):(0===u.length&&!1===o&&u.context,this.keydown.insertBreakLine(t));if(this.opts.linebreaks&&this.keydown.block)setTimeout(p.proxy(this.keydown.replaceDivToBreakLine,this),1);else if(!this.opts.linebreaks&&this.keydown.block){if(setTimeout(p.proxy(this.keydown.replaceDivToParagraph,this),1),"LI"===this.keydown.block.tagName){var s,o=this.selection.getCurrent(),i=p(o).closest("li",this.$editor[0]),r=i.closest("ul,ol",this.$editor[0]);if(0!==i.length&&this.utils.isEmpty(i.html())&&0===r.next().length&&this.utils.isEmpty(r.find("li").last().html()))return r.find("li").last().remove(),s=p(this.opts.emptyHtml),r.after(s),this.caret.setStart(s),!1}}else if(!this.opts.linebreaks&&!this.keydown.block)return this.keydown.insertParagraph(t)}if(e===this.keyCode.ENTER&&(t.ctrlKey||t.shiftKey))return this.keydown.onShiftEnter(t);if(e===this.keyCode.TAB||t.metaKey&&221===e||t.metaKey&&219===e)return this.keydown.onTab(t,e);if(e===this.keyCode.BACKSPACE||e===this.keyCode.DELETE){var a=this.selection.getNodes();if(a)for(var n,l=a.length,c=0;c<l;c++){var h,d=p(a[c]).children("img");0!==d.length?(h=this,p.each(d,function(t,e){var i=p(e);"none"==i.css("float")&&(h.core.setCallback("imageDelete",e.src,i),n=e)})):"IMG"==a[c].tagName&&n!=a[c]&&(this.core.setCallback("imageDelete",a[c].src,p(a[c])),n=a[c])}}if(e===this.keyCode.BACKSPACE){var u=this.selection.getBlock(),o="0px"!==p(u).css("margin-left");if(u&&o&&this.range.collapsed&&this.utils.isStartOfElement())return this.indent.decrease(),void t.preventDefault();this.utils.browser("mozilla")&&(i=this.selection.getPrev(),r=p(i).prev()[0],i&&"HR"===i.tagName&&p(i).remove(),r)&&"HR"===r.tagName&&p(r).remove(),this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(t)}this.code.sync()}else t.preventDefault(),this.range.collapsed||this.range.deleteContents()}},checkEvents:function(t,e){t||"click"!=this.core.getEvent()&&"arrow"!=this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(e)&&this.buffer.set())},checkKeyEvents:function(t){var e=this.keyCode,e=[e.BACKSPACE,e.DELETE,e.ENTER,e.SPACE,e.ESC,e.TAB,e.CTRL,e.META,e.ALT,e.SHIFT];return-1==p.inArray(t,e)},addArrowsEvent:function(t){t&&("click"==this.core.getEvent()||"arrow"==this.core.getEvent()?this.core.addEvent(!1):this.core.addEvent("arrow"))},setupBuffer:function(t,e){this.keydown.ctrl&&90===e&&!t.shiftKey&&!t.altKey&&this.opts.buffer.length?(t.preventDefault(),this.buffer.undo()):this.keydown.ctrl&&90===e&&t.shiftKey&&!t.altKey&&0!==this.opts.rebuffer.length?(t.preventDefault(),this.buffer.redo()):this.keydown.ctrl||e!=this.keyCode.BACKSPACE&&e!=this.keyCode.DELETE&&(e!=this.keyCode.ENTER||t.ctrlKey||t.shiftKey)&&e!=this.keyCode.SPACE||this.buffer.set()},setupSelectAll:function(t,e){this.keydown.ctrl&&65===e?this.utils.enableSelectAll():e==this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},onArrowDown:function(){for(var t=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],e=0;e<t.length;e++)if(t[e])return this.keydown.insertAfterLastElement(t[e]),!1},onShiftEnter:function(t){return this.buffer.set(),this.utils.isEndOfElement()?this.keydown.insertDblBreakLine(t):this.keydown.insertBreakLine(t)},onTab:function(t,e){var i;return!this.opts.tabKey||!(!this.utils.isEmpty(this.code.get())||!1!==this.opts.tabAsSpaces)||(t.preventDefault(),this.keydown.pre&&!t.shiftKey?(i=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("\t"),this.insert.node(i),this.code.sync()):!1!==this.opts.tabAsSpaces?(i=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(i),this.code.sync()):t.metaKey&&219===e||(!t.metaKey||221!==e)&&t.shiftKey?this.indent.decrease():this.indent.increase(),!1)},replaceDivToBreakLine:function(){var t=this.selection.getBlock(),e=t.innerHTML.replace(/<br\s?\/?>/gi,"");if(("DIV"===t.tagName||"P"===t.tagName)&&""===e&&!p(t).hasClass("redactor-editor"))return e=document.createElement("br"),p(t).replaceWith(e),this.caret.setBefore(e),this.code.sync(),!1},replaceDivToParagraph:function(){var t=this.selection.getBlock(),e=t.innerHTML.replace(/<br\s?\/?>/gi,"");if("DIV"===t.tagName&&this.utils.isEmpty(e)&&!p(t).hasClass("redactor-editor"))return(e=document.createElement("p")).innerHTML=this.opts.invisibleSpace,p(t).replaceWith(e),this.caret.setStart(e),this.code.sync(),!1;this.opts.cleanStyleOnEnter&&"P"==t.tagName&&p(t).removeAttr("class").removeAttr("style")},insertParagraph:function(t){t.preventDefault(),this.selection.get();t=document.createElement("p");return t.innerHTML=this.opts.invisibleSpace,this.range.deleteContents(),this.range.insertNode(t),this.caret.setStart(t),this.code.sync(),!1},exitFromBlockquote:function(t){var e;return this.utils.isEndOfElement()&&-1!=(e=p(this.keydown.block).html().trim()).search(/(<br\s?\/?>){2}$/i)?(t.preventDefault(),this.opts.linebreaks?(t=document.createElement("br"),p(this.keydown.blockquote).after(t),this.caret.setBefore(t),p(this.keydown.block).html(e.replace(/<br\s?\/?>$/i,""))):(t=p(this.opts.emptyHtml),p(this.keydown.blockquote).after(t),this.caret.setStart(t)),!0):void 0},insertAfterLastElement:function(t){var e,i;this.utils.isEndOfElement()&&(this.buffer.set(),this.opts.linebreaks?("SPAN"==(i=(e=p("<div>").append(this.$editor.html().trim()).contents()).last()[0]).tagName&&""===i.innerHTML&&(i=e.prev()[0]),this.utils.getOuterHtml(i)==this.utils.getOuterHtml(t)&&(e=document.createElement("br"),p(t).after(e),this.caret.setAfter(e))):this.$editor.contents().last()[0]===t&&(i=p(this.opts.emptyHtml),p(t).after(i),this.caret.setStart(i)))},insertNewLine:function(t){t.preventDefault();t=document.createTextNode("\n");return this.selection.get(),this.range.deleteContents(),this.range.insertNode(t),this.caret.setAfter(t),this.code.sync(),!1},insertBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t)},insertDblBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t,!0)},insertBreakLineProcessing:function(t,e){t.stopPropagation(),this.selection.get();var t=document.createElement("br"),i=(this.utils.browser("msie")?(this.range.collapse(!1),this.range.setEnd(this.range.endContainer,this.range.endOffset)):this.range.deleteContents(),this.range.insertNode(t),p(t).parent("a"));if(0<i.length&&(i.find(t).remove(),i.after(t)),!0===e){var i=p(t).next();if(0!==i.length&&"BR"===i[0].tagName&&this.utils.isEndOfEditor())return this.caret.setAfter(t),this.code.sync(),!1;var e=document.createElement("br");this.range.insertNode(e),this.caret.setAfter(e)}else this.utils.browser("msie")?((i=document.createElement("span")).innerHTML="&#x200b;",p(t).after(i),this.caret.setAfter(i),p(i).remove()):((e=document.createRange()).setStartAfter(t),e.collapse(!0),(i=window.getSelection()).removeAllRanges(),i.addRange(e));return this.code.sync(),!1},removeInvisibleSpace:function(){var t=p(this.keydown.current);0===t.text().search(/^\u200B$/g)&&t.remove()},removeEmptyListInTable:function(t){var e=p(this.keydown.current),i=p(this.keydown.parent),s=e.closest("td",this.$editor[0]);0!==s.length&&e.closest("li",this.$editor[0])&&1===i.children("li").length&&this.utils.isEmpty(e.text())&&(t.preventDefault(),e.remove(),i.remove(),this.caret.setStart(s))}}},keyup:function(){return{init:function(t){if(!this.rtePaste){var e=t.which,i=(this.keyup.current=this.selection.getCurrent(),this.keyup.parent=this.selection.getParent(),this.utils.isRedactorParent(p(this.keyup.parent).parent()));if(!1===this.core.setCallback("keyup",t))return t.preventDefault(),!1;if(!this.opts.linebreaks&&3==this.keyup.current.nodeType&&this.keyup.current.length<=1&&(!1===this.keyup.parent||"BODY"==this.keyup.parent.tagName)&&this.keyup.replaceToParagraph(),!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&"DIV"===this.keyup.current.tagName&&this.keyup.replaceToParagraph(!1),this.opts.linebreaks||!p(this.keyup.parent).hasClass("redactor-invisible-space")||!1!==i&&"BODY"!=i[0].tagName||(p(this.keyup.parent).contents().unwrap(),this.keyup.replaceToParagraph()),this.linkify.isEnabled()&&this.linkify.isKey(e)&&this.linkify.format(),e===this.keyCode.DELETE||e===this.keyCode.BACKSPACE){if(this.utils.browser("mozilla")){i=p(this.keydown.current).closest("td",this.$editor[0]);if(0!==i.size()&&""!==i.text())return t.preventDefault(),!1}return(this.clean.clearUnverified(),this.observe.image)?(t.preventDefault(),this.image.hideResize(),this.buffer.set(),this.image.remove(this.observe.image),this.observe.image=!1):(this.$editor.find("p").each(p.proxy(function(t,e){this.utils.removeEmpty(t,p(e).html())},this)),this.opts.linebreaks&&this.keyup.current&&"DIV"==this.keyup.current.tagName&&this.utils.isEmpty(this.keyup.current.innerHTML)&&(p(this.keyup.current).after(this.selection.getMarkerAsHtml()),this.selection.restore(),p(this.keyup.current).remove()),this.keyup.formatEmpty(t))}}},replaceToParagraph:function(t){var e=p(this.keyup.current),t=!1===t?p("<p>").append(e.html()):p("<p>").append(e.clone()),e=(e.replaceWith(t),p(t).next());void 0!==e[0]&&"BR"==e[0].tagName&&e.remove(),this.caret.setEnd(t)},formatEmpty:function(t){var e=this.$editor.html().trim();if(this.utils.isEmpty(e))return t.preventDefault(),this.opts.linebreaks?(this.$editor.html(this.selection.getMarkerAsHtml()),this.selection.restore()):(this.$editor.html(this.opts.emptyHtml),this.focus.setStart()),this.code.sync(),!1}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(t){return void 0!==this.opts.curLang[t]?this.opts.curLang[t]:""}}},line:function(){return{insert:function(){this.buffer.set();var t=this.selection.getBlocks();!1!==t[0]&&this.line.isExceptLastOrFirst(t)?this.utils.browser("msie")||this.$editor.focus():this.utils.browser("msie")?this.line.insertInIe():this.line.insertInOthersBrowsers()},isExceptLastOrFirst:function(t){var e=["li","td","th","blockquote","figcaption","pre","dl","dt","dd"],t=t[0].tagName.toLowerCase(),i=void 0===(i=this.selection.getLastBlock())?t:i.tagName.toLowerCase(),t=-1!=p.inArray(t,e),i=-1!=p.inArray(i,e);if(t&&i||t)return!0},insertInIe:function(){this.utils.saveScroll(),this.buffer.set(),this.insert.node(document.createElement("hr")),this.utils.restoreScroll(),this.code.sync()},insertInOthersBrowsers:function(){this.buffer.set();var t='<p id="redactor-insert-line"><br /></p>';this.opts.linebreaks&&(t='<br id="redactor-insert-line">'),document.execCommand("insertHtml",!1,"<hr>"+t),this.line.setFocus(),this.code.sync()},setFocus:function(){var t=this.$editor.find("#redactor-insert-line"),e=p(t).next()[0],i=e;this.utils.browser("mozilla")&&e&&""===e.innerHTML&&(i=p(e).next()[0],p(e).remove()),i?(t.remove(),this.opts.linebreaks||(this.$editor.focus(),this.line.setStart(i))):(t.removeAttr("id"),this.line.setStart(t[0]))},setStart:function(t){var e;void 0!==t&&(e=document.createTextNode("​"),this.selection.get(),this.range.setStart(t,0),this.range.insertNode(e),this.range.collapse(!0),this.selection.addRange())}}},link:function(){return{show:function(t){void 0!==t&&t.preventDefault&&t.preventDefault(),this.observe.isCurrent("a")?this.modal.load("link",this.lang.get("link_edit"),600):this.modal.load("link",this.lang.get("link_insert"),600),this.modal.createCancelButton();var t=this.observe.isCurrent("a")?this.lang.get("edit"):this.lang.get("insert"),i=(this.link.buttonInsert=this.modal.createActionButton(t),this.selection.get(),this.link.getData(),this.link.cleanUrl(),this.link.$selectStyleFieldGroup=p("div[data-field-group=mailer]"),this.opts.concrete5.mailer&&this.link.$selectStyleFieldGroup.is(":hidden")&&this.link.$selectStyleFieldGroup.show(),this.link.$selectUrlOpen=p("#redactor-link-url-open"),this.opts.concrete5.lightbox||this.link.$selectUrlOpen.find("option[value=lightbox]").remove(),this.link.$selectUrlLightboxFieldGroup=p("div[data-field-group=lightbox]"),this.link.$selectUrlLightboxIframeFieldGroup=p("div[data-field-group=lightbox-iframe]"),this.link.$selectUrlLightboxFieldGroupSelect=p("div[data-field-group=lightbox] select"),this.link.$selectUrlLightboxIframeWidth=p("#redactor-link-lightbox-iframe-width"),this.link.$selectUrlLightboxIframeHeight=p("#redactor-link-lightbox-iframe-height"),this.link.$selectUrlOpen.val(this.link.linkType),this.link.$selectUrlLightboxIframeWidth.val(this.link.linkLightboxIframeWidth),this.link.$selectUrlLightboxIframeHeight.val(this.link.linkLightboxIframeHeight),this.link);this.link.$selectUrlOpen.on("change",function(){"lightbox"==p(this).val()?i.$selectUrlLightboxFieldGroup.show():(i.$selectUrlLightboxFieldGroup.hide(),i.$selectUrlLightboxFieldGroupSelect.val("image").trigger("change"))}).trigger("change"),this.link.$selectUrlLightboxFieldGroupSelect.val(this.link.linkLightboxType),this.link.$selectUrlLightboxFieldGroupSelect.on("change",function(){"iframe"==p(this).val()?i.$selectUrlLightboxIframeFieldGroup.show():i.$selectUrlLightboxIframeFieldGroup.hide()}).trigger("change"),this.link.$inputUrl=p("#redactor-link-url"),this.link.$inputText=p("#redactor-link-url-text"),this.opts.concrete5.mailer&&(this.link.$inputStyle=p("#redactor-link-url-style"),this.link.$inputStyle.val(this.link.style)),this.link.$inputText.val(this.link.text),this.link.$inputUrl.val(this.link.url),this.link.buttonInsert.on("click",p.proxy(this.link.insert,this)),p(".redactor-link-tooltip").remove(),this.opts.concrete5.filemanager?p("a[data-action=choose-file-from-file-manager]").on("click",function(t){t.preventDefault(),ConcreteFileManager.launchDialog(function(t){jQuery.fn.dialog.showLoader(),ConcreteFileManager.getFileDetails(t.fID,function(t){jQuery.fn.dialog.hideLoader();t=t.files[0];i.$inputUrl.val(t.urlDownload)})})}):p("a[data-action=choose-file-from-file-manager]").remove(),this.opts.concrete5.sitemap?p("a[data-action=choose-link-from-sitemap]").on("click",function(t){t.preventDefault(),jQuery.fn.dialog.open({width:"90%",height:"70%",modal:!1,title:ccmi18n_sitemap.choosePage,href:CCM_TOOLS_PATH+"/sitemap_search_selector",data:{includeDraftPages:1}}),ConcreteEvent.unsubscribe("SitemapSelectPage"),ConcreteEvent.subscribe("SitemapSelectPage",function(t,e){jQuery.fn.dialog.closeTop();e=CCM_APPLICATION_URL+"/index.php?cID="+e.cID;i.$inputUrl.val(e)})}):p("a[data-action=choose-link-from-sitemap]").remove(),this.opts.concrete5.sitemap||this.opts.concrete5.filemanager||p("#redactor-link-url").parent().removeClass(),this.selection.save(),this.modal.show(),this.link.$inputUrl.focus()},cleanUrl:function(){var t=self.location.href.replace(/\/$/i,"");void 0!==this.link.url&&(this.link.url=this.link.url.replace(t,""),this.link.url=this.link.url.replace(/^\/#/,"#"),this.link.url=this.link.url.replace("mailto:",""),this.opts.linkProtocol||(t=new RegExp("^(http|ftp|https)://"+self.location.host,"i"),this.link.url=this.link.url.replace(t,"")))},getData:function(){this.link.$node=!1;var t,e=p(this.selection.getCurrent()).closest("a",this.$editor[0]);this.link.style="text",0!==e.length&&"A"===e[0].tagName?(this.link.$node=e,this.opts.concrete5.mailer&&(this.link.style=e.hasClass("btn-link-redactor")?"button":"text"),this.link.url=e.attr("href"),this.link.text=e.text(),this.link.target=e.attr("target"),t=e.attr("data-concrete5-link-lightbox"),this.link.linkLightboxType="image",this.link.linkLightboxIframeWidth="600",this.link.linkLightboxIframeHeight="400","_blank"==this.link.target?this.link.linkType="blank":"image"==t||"iframe"==t?(this.link.linkType="lightbox",this.link.linkLightboxType=t,this.link.linkLightboxIframeWidth=e.attr("data-concrete5-link-lightbox-width"),this.link.linkLightboxIframeHeight=e.attr("data-concrete5-link-lightbox-height")):this.link.linkType="same"):(this.link.text=this.sel.toString(),this.link.url="",this.link.target="",this.link.linkType="same",this.link.linkLightboxType="image",this.link.linkLightboxIframeWidth="600",this.link.linkLightboxIframeHeight="400")},insert:function(){this.placeholder.remove();var t,e,i,s="",o=this.link.$inputUrl.val(),r=this.link.$inputText.val().replace(/(<([^>]+)>)/gi,""),a="text",n=null,l=null,c=null;""===o.trim()?this.link.$inputUrl.addClass("redactor-input-error").on("keyup",function(){p(this).removeClass("redactor-input-error"),p(this).off("keyup")}):(this.opts.concrete5.mailer&&(a=this.link.$inputStyle.val()),-1!=o.search("@")&&!1===/(http|ftp|https):\/\//i.test(o)?o="mailto:"+o:0!==o.search("#")&&("blank"==p("#redactor-link-url-open").val()&&(s="_blank"),"lightbox"==p("#redactor-link-url-open").val()&&"iframe"==(n=p("#redactor-link-lightbox-type").val())&&(l=p("#redactor-link-lightbox-iframe-width").val(),c=p("#redactor-link-lightbox-iframe-height").val()),e="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",t=new RegExp("^(http|ftp|https)://"+e,"i"),e=new RegExp("^"+e,"i"),i=new RegExp(".(html|php)$","i"),-1==o.search(t))&&-1==o.search(i)&&0===o.search(e)&&this.opts.linkProtocol&&(o=this.opts.linkProtocol+"://"+o),this.link.set(r,o,s,a,n,l,c),this.modal.close())},createLinkButton:function(t,e,i,s){return s.addClass("btn-link-redactor"),s},removeLinkButton:function(t){return t.removeClass("btn-link-redactor"),t},set:function(t,e,i,s,o,r,a){t=t.replace(/<|>/g,"").trim(),this.selection.restore();var n,l=this.selection.getBlocks();if(""!==t||""!==e){if(""===t&&""!==e&&(t=e),this.link.$node){this.buffer.set();var c=this.link.$node,h=c.children();if(0<h.length){for(;h.length;)h=h.children();h=h.end()}else h=c;c.attr("href",e),h.text(t),c.removeAttr("data-concrete5-link-lightbox"),c.removeAttr("data-concrete5-link-lightbox-width"),c.removeAttr("data-concrete5-link-lightbox-height"),""!==i?c.attr("target",i):(c.removeAttr("target"),o&&(c.attr("data-concrete5-link-lightbox",o),"iframe"==o)&&r&&a&&(c.attr("data-concrete5-link-lightbox-width",r),c.attr("data-concrete5-link-lightbox-height",a))),this.opts.concrete5.mailer&&(c="text"==s?this.link.removeLinkButton(c):this.link.createLinkButton(t,e,i,c)),this.selection.selectElement(c),this.code.sync()}else this.utils.browser("mozilla")&&""===this.link.text?(n=p("<a />").attr("href",e).text(t),""!==i&&n.attr("target",i),this.opts.concrete5.mailer&&(n="text"==s?this.link.removeLinkButton(n):this.link.createLinkButton(t,e,i,n)),this.insert.node(n),this.selection.selectElement(n)):this.utils.browser("msie")?(n=p('<a href="'+e+'">').text(t),""!==i&&n.attr("target",i),this.opts.concrete5.mailer&&(n="text"==s?this.link.removeLinkButton(n):this.link.createLinkButton(t,e,i,n)),n=p(this.insert.node(n)),this.selection.getText().match(/\s$/)&&n.after(" "),this.selection.selectElement(n)):(document.execCommand("createLink",!1,e),n=p(this.selection.getCurrent()).closest("a",this.$editor[0]),this.utils.browser("mozilla")&&(n=p('a[_moz_dirty=""]')),""!==i&&n.attr("target",i),n.removeAttr("style").removeAttr("_moz_dirty"),this.selection.getText().match(/\s$/)&&n.after(" "),""===this.link.text&&this.link.text==t||(!this.opts.linebreaks&&l&&l.length<=1&&n.text(t),this.opts.concrete5.mailer&&(n="text"==s?this.link.removeLinkButton(n):this.link.createLinkButton(t,e,i,n)),this.selection.selectElement(n))),o&&(n.attr("data-concrete5-link-lightbox",o),"iframe"==o)&&r&&a&&(n.attr("data-concrete5-link-lightbox-width",r),n.attr("data-concrete5-link-lightbox-height",a)),this.code.sync(),this.core.setCallback("insertedLink",n);setTimeout(p.proxy(function(){this.observe.links()},this),5)}},unlink:function(t){void 0!==t&&t.preventDefault&&t.preventDefault();var e=this.selection.getNodes();if(e){this.buffer.set();for(var i=e.length,s=[],o=0;o<i;o++){"A"===e[o].tagName&&s.push(e[o]);var r=p(e[o]).closest("a",this.$editor[0]);(r=this.opts.concrete5.mailer?this.link.removeLinkButton(r):r).replaceWith(r.contents())}this.core.setCallback("deletedLink",s),p(".redactor-link-tooltip").remove(),this.code.sync()}},toggleClass:function(t){this.link.setClass(t,"toggleClass")},addClass:function(t){this.link.setClass(t,"addClass")},removeClass:function(t){this.link.setClass(t,"removeClass")},setClass:function(t,e){var i=this.selection.getInlinesTags(["a"]);!1!==i&&p.each(i,function(){p(this)[e](t)})}}},linkify:function(){return{isKey:function(t){return t==this.keyCode.ENTER||t==this.keyCode.SPACE},isEnabled:function(){return this.opts.convertLinks&&(this.opts.convertUrlLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&!this.utils.isCurrentOrParent("PRE")},format:function(){var i=this.linkify,s=this.opts,t=(this.$editor.find(":not(iframe,img,a,pre)").addBack().contents().filter(function(){return 3===this.nodeType&&""!=this.nodeValue.trim()&&!p(this).parent().is("pre")&&(this.nodeValue.match(s.linkify.regexps.youtube)||this.nodeValue.match(s.linkify.regexps.vimeo)||this.nodeValue.match(s.linkify.regexps.image)||this.nodeValue.match(s.linkify.regexps.url))}).each(function(){var t=p(this).text(),e=t;s.convertVideoLinks&&(e.match(s.linkify.regexps.youtube)||e.match(s.linkify.regexps.vimeo))?e=i.convertVideoLinks(e):s.convertImageLinks&&e.match(s.linkify.regexps.image)?e=i.convertImages(e):s.convertUrlLinks&&(e=i.convertLinks(e)),p(this).before(t.replace(t,e)).remove()}),this.$editor.find(".redactor-linkify-object").each(function(){var t=p(this);return t.removeClass("redactor-linkify-object"),""===t.attr("class")&&t.removeAttr("class"),t[0]}));this.core.setCallback("linkify",t),this.code.sync()},convertVideoLinks:function(t){var e='<iframe class="redactor-linkify-object" width="500" height="281" src="',i='" frameborder="0" allowfullscreen></iframe>';return t=(t=t.match(this.opts.linkify.regexps.youtube)?t.replace(this.opts.linkify.regexps.youtube,e+"//www.youtube.com/embed/$1"+i):t).match(this.opts.linkify.regexps.vimeo)?t.replace(this.opts.linkify.regexps.vimeo,e+"//player.vimeo.com/video/$2"+i):t},convertImages:function(t){var e=t.match(this.opts.linkify.regexps.image);return e&&(t=t.replace(t,'<img src="'+e+'" class="redactor-linkify-object" />'),this.opts.linebreaks&&!this.utils.isEmpty(this.code.get())&&(t="<br>"+t),t+="<br>"),t},convertLinks:function(t){var i=t.match(this.opts.linkify.regexps.url);if(i)for(var e=(i=p.grep(i,function(t,e){return p.inArray(t,i)===e})).length,s=0;s<e;s++){var o=i[s],r=o,a=this.opts.linkProtocol+"://",n=(null!==o.match(/(https?|ftp):\/\//i)&&(a=""),r.length>this.opts.linkSize&&(r=r.substring(0,this.opts.linkSize)+"..."),r=decodeURIComponent(r),"\\b"),n=(-1!=p.inArray(o.slice(-1),["/","&","="])&&(n=""),new RegExp("("+o.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+n+")","g"));t=t.replace(n,'<a href="'+a+o.trim()+'" class="redactor-linkify-object">'+r.trim()+"</a>")}return t}}},list:function(){return{toggle:function(t){this.placeholder.remove(),this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var e,i,s=this.selection.getParent(),s=p(s).closest("ol, ul",this.$editor[0]),o=!1;(s=this.utils.isRedactorParent(s)||0===s.length?s:!1)&&s.length&&(o=!0,i=s[0].tagName,e="orderedlist"===t&&"UL"===i,i="unorderedlist"===t&&"OL"===i),e?this.utils.replaceToTag(s,"ol"):i?this.utils.replaceToTag(s,"ul"):o?this.list.remove(t,s):this.list.insert(t),this.selection.restore(),this.code.sync()},insert:function(t){var e,i=this.selection.getCurrent(),i=p(i).closest("td, th",this.$editor[0]),t=(this.utils.browser("msie")&&this.opts.linebreaks?this.list.insertInIe(t):document.execCommand("insert"+t),this.selection.getParent()),t=p(t).closest("ol, ul",this.$editor[0]);0!==i.length&&(e=i.clone(),i.after(e).remove("")),this.utils.isEmpty(t.find("li").text())&&((i=t.children("li")).find("br").remove(),i.append(this.selection.getMarkerAsHtml()),this.opts.linebreaks)&&this.utils.browser("mozilla")&&2==i.size()&&this.utils.isEmpty(i.eq(1).text())&&i.eq(1).remove(),t.length&&(e=t.parent(),this.utils.isRedactorParent(e))&&"LI"!=e[0].tagName&&this.utils.isBlock(e[0])&&e.replaceWith(e.contents()),this.utils.browser("msie")||this.$editor.focus(),this.clean.clearUnverified()},insertInIe:function(t){var e=this.selection.wrap("div"),i=p(e).html(),s=p("orderedlist"==t?"<ol>":"<ul>"),t=p("<li>");if(""===i.trim())t.append(this.selection.getMarkerAsHtml()),s.append(t),this.$editor.find("#selection-marker-1").replaceWith(s);else{var o=i.split(/<br\s?\/?>/gi);if(o)for(var r=0;r<o.length;r++)""!==o[r].trim()&&s.append(p("<li>").html(o[r]));else t.append(i),s.append(t);p(e).replaceWith(s)}},remove:function(t,e){p.inArray("ul",this.selection.getBlocks())&&(t="unorderedlist"),document.execCommand("insert"+t);var t=p(this.selection.getCurrent()),t=(this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==t.closest("li, th, td",this.$editor[0]).length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote").each(p.proxy(this.utils.removeEmpty,this))),p(this.selection.getCurrent()).closest("table",this.$editor[0])),i=t.prev();this.opts.linebreaks||0===t.length||0===i.length||"BR"!=i[0].tagName||i.remove(),this.clean.clearUnverified()}}},modal:function(){return{callbacks:{},getLinkFields:function(){return String()+'<div class="form-group"><label class="control-label">'+this.lang.get("open_link")+'</label><select class="form-control" id="redactor-link-url-open"><option value="same">'+this.lang.get("link_same_window")+'</option><option value="blank">'+this.lang.get("link_new_tab")+'</option><option value="lightbox">'+this.lang.get("in_lightbox")+'</option></select></div><div data-field-group="mailer" style="display: none" class="form-group"><label class="control-label">'+this.lang.get("link_style")+'</label><select class="form-control" id="redactor-link-url-style"><option value="text">'+this.lang.get("link_style_text")+'</option><option value="button">'+this.lang.get("link_style_button")+'</option></select></div><div data-field-group="lightbox" style="display: none" class="form-group"><label class="control-label">'+this.lang.get("lightbox_link_type")+'</label><select class="form-control" id="redactor-link-lightbox-type"><option value="image">'+this.lang.get("lightbox_link_type_image")+'</option><option value="iframe">'+this.lang.get("lightbox_link_type_iframe")+'</option></select></div><div data-field-group="lightbox-iframe" style="display: none"><div class="form-group"><label class="control-label">'+this.lang.get("lightbox_link_type_iframe_width")+'</label><input class="form-control" type="text" id="redactor-link-lightbox-iframe-width" /></div><div class="form-group"><label class="control-label">'+this.lang.get("lightbox_link_type_iframe_height")+'</label><input class="form-control" type="text" id="redactor-link-lightbox-iframe-height" /></div></div>'},loadTemplates:function(){this.opts.modal={imageEdit:String()+'<section id="redactor-modal-image-edit"><div class="form-group"><label class="control-label">'+this.lang.get("alt")+'</label><input type="text" class="form-control" id="redactor-image-alt" /></div><div class="form-group"><label class="control-label redactor-image-link-option">'+this.lang.get("link")+'</label><div class="input-group"><input type="text" class="form-control" id="redactor-image-link" /><a href="#" data-action="choose-link-from-sitemap" class="btn btn-default input-group-addon"><i class="fa fa-sitemap"></i></a><a href="#" data-action="choose-file-from-file-manager" class="btn btn-default input-group-addon"><i class="fa fa-file"></i></a></div></div>'+this.modal.getLinkFields()+'<div class="form-group"><label class="control-label redactor-image-position-option">'+this.lang.get("image_position")+'</label><select class="form-control redactor-image-position-option" id="redactor-image-align"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+"</option></select></div></section>",image:String()+'<section id="redactor-modal-image-insert"><div class="form-group"><label class="control-label">'+this.lang.get("image_web_link")+'</label><div class="input-group"><input type="text" name="redactor-image-link" id="redactor-image-link" class="form-control"  /><a href="#" data-action="choose-image-from-file-manager" class="btn btn-default input-group-addon"><i class="fa fa-file"></i></a></div></div></section>',file:String()+'<section id="redactor-modal-file-insert"><div class="form-group"><label class="control-label">'+this.lang.get("file")+'</label><div class="input-group"><input type="text" name="redactor-file-link" id="redactor-file-link" class="form-control"  /><a href="#" data-action="choose-image-from-file-manager" class="btn btn-default input-group-addon"><i class="fa fa-search"></i></a></div></div><div class="form-group"><label class="control-label">'+this.lang.get("text")+'</label><input class="form-control" type="text" id="redactor-filename" /></div></section>',link:String()+'<section id="redactor-modal-link-insert"><div class="form-group"><label class="control-label">'+this.lang.get("web")+'</label><div class="input-group"><input type="text" class="form-control" id="redactor-link-url" /><a href="#" data-action="choose-link-from-sitemap" class="btn btn-default input-group-addon"><i class="fa fa-sitemap"></i></a><a href="#" data-action="choose-file-from-file-manager" class="btn btn-default input-group-addon"><i class="fa fa-file"></i></a></div></div><div class="form-group"><label class="control-label">'+this.lang.get("text")+'</label><input class="form-control" type="text" id="redactor-link-url-text" /></div>'+this.modal.getLinkFields()+"</section>"},p.extend(this.opts,this.opts.modal)},addCallback:function(t,e){this.modal.callbacks[t]=e},createTabber:function(t){this.modal.$tabber=p("<div>").attr("id","redactor-modal-tabber"),t.prepend(this.modal.$tabber)},addTab:function(t,e,i){var t=p('<a href="#" rel="tab'+t+'">').text(e),s=(i&&t.addClass("active"),this);t.on("click",function(t){t.preventDefault(),p(".redactor-tab").hide(),p(".redactor-"+p(this).attr("rel")).show(),s.modal.$tabber.find("a").removeClass("active"),p(this).addClass("active")}),this.modal.$tabber.append(t)},addTemplate:function(t,e){this.opts.modal[t]=e},getTemplate:function(t){return this.opts.modal[t]},getModal:function(){return this.$modalBody.find("section")},load:function(t,e,i){this.modal.templateName=t,this.modal.width=i,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(e),this.modal.setDraggable(),this.modal.setContent(),void 0!==this.modal.callbacks[t]&&this.modal.callbacks[t].call(this)},show:function(){this.utils.disableBodyScroll(),this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop(),this.opts.highContrast&&this.$modalBox.addClass("redactor-modal-contrast"),this.$modalOverlay.show(),this.$modalBox.show(),this.$modal.attr("tabindex","-1"),this.$modal.focus(),this.modal.setButtonsWidth(),this.utils.saveScroll(),this.utils.isMobile()||(setTimeout(p.proxy(this.modal.showOnDesktop,this),0),p(window).on("resize.redactor-modal",p.proxy(this.modal.resize,this))),this.core.setCallback("modalOpened",this.modal.templateName,this.$modal),p(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",p.proxy(this.modal.setEnter,this))},showOnDesktop:function(){var t=this.$modal.outerHeight(),e=p(window).height(),i=p(window).width();this.modal.width>i?this.$modal.css({width:"96%",marginTop:e/2-t/2+"px"}):e<t?this.$modal.css({width:this.modal.width+"px",marginTop:"20px"}):this.$modal.css({width:this.modal.width+"px",marginTop:e/2-t/2+"px"})},showOnMobile:function(){this.$modal.css({width:"96%",marginTop:"2%"})},resize:function(){this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop()},setTitle:function(t){this.$modalHeader.html(t)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName))},setDraggable:function(){void 0!==p.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(t){13==t.which&&(t.preventDefault(),this.$modal.find("button.redactor-modal-action-btn").click())},createCancelButton:function(){var t=p("<button>").addClass("btn btn-default redactor-modal-close-btn").html(this.lang.get("cancel"));t.on("click",p.proxy(this.modal.close,this)),this.$modalFooter.append(t)},createDeleteButton:function(t){return this.modal.createButton(t,"danger")},createActionButton:function(t){return this.modal.createButton(t,"primary")},createButton:function(t,e){e=p("<button>").addClass("btn pull-right").addClass("btn-"+e).html(t);return this.$modalFooter.append(e),e},setButtonsWidth:function(){var t=this.$modalFooter.find("button").length;0!==t&&0===t&&this.$modalFooter.remove()},build:function(){this.modal.buildOverlay(),this.$modalBox=p('<div id="redactor-modal-box" />').hide(),this.$modal=p('<div id="redactor-modal" />'),this.$modalHeader=p("<header />"),this.$modalBox.addClass("ccm-ui"),this.$modalClose=p('<span class="ui-button-icon-primary ui-icon ui-icon-closethick" />'),this.$modalCloseWrapper=p('<span id="redactor-modal-close"><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button"><span class="ui-button-text">close</span></button></span>'),this.$modalClose.appendTo(this.$modalCloseWrapper.find("button.ui-button")),this.$modalBody=p('<div id="redactor-modal-body" />'),this.$modalFooter=p("<footer />"),this.$modal.addClass("ccm-interaction-dialog"),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalCloseWrapper),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalFooter),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body);var t=this.$modalBox.siblings(".ui-front:visible").map(function(){return+p(this).css("z-index")}).get(),t=Math.max.apply(null,t);t>=+this.$modalBox.css("z-index")&&this.$modalBox.css("z-index",t+1)},buildOverlay:function(){this.$modalOverlay=p('<div id="redactor-modal-overlay">').hide(),p("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.find("button").on("click.redactor-modal",p.proxy(this.modal.close,this)),p(document).on("keyup.redactor-modal",p.proxy(this.modal.closeHandler,this)),this.$editor.on("keyup.redactor-modal",p.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",p.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.find("button").off("click.redactor-modal"),p(document).off("keyup.redactor-modal"),this.$editor.off("keyup.redactor-modal"),this.$modalBox.off("click.redactor-modal"),p(window).off("resize.redactor-modal")},closeHandler:function(t){t.which==this.keyCode.ESC&&this.modal.close(!1)},close:function(t){if(t){if(!p(t.target).hasClass("redactor-modal-close-btn")&&t.target!=this.$modalClose[0]&&t.target!=this.$modalBox[0])return;t.preventDefault()}this.$modalBox&&(this.modal.disableEvents(),this.utils.enableBodyScroll(),this.$modalOverlay.remove(),this.$modalBox.fadeOut("fast",p.proxy(function(){this.$modalBox.remove(),setTimeout(p.proxy(this.utils.restoreScroll,this),0),void 0!==t&&this.selection.restore(),p(document.body).css("overflow",this.modal.bodyOveflow),this.core.setCallback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){var t;void 0===this.opts.destroyed&&(this.utils.browser("msie")&&(t=this).$editor.find("pre, code").on("mouseover",function(){t.$editor.attr("contenteditable",!1),p(this).attr("contenteditable",!0)}).on("mouseout",function(){t.$editor.attr("contenteditable",!0),p(this).removeAttr("contenteditable")}),this.observe.images(),this.observe.links())},toolbar:function(t,e){this.observe.buttons(t,e),this.observe.dropdowns()},isCurrent:function(t,e){return(e=void 0===e?p(this.selection.getCurrent()):e).is(t)||0<e.parents(t).length},dropdowns:function(){var r=p(this.selection.getCurrent());p.each(this.opts.observe.dropdowns,p.proxy(function(t,e){var i=e.observe,s=i.element,e=e.item,o=void 0!==i.in&&i.in,i=void 0!==i.out&&i.out;0<r.closest(s).size()?this.observe.setDropdownProperties(e,o,i):this.observe.setDropdownProperties(e,i,o)},this))},setDropdownProperties:function(t,e,i){if(i&&void 0!==i.attr&&this.observe.setDropdownAttr(t,i.attr,!0),void 0!==e.attr&&this.observe.setDropdownAttr(t,e.attr),void 0!==e.title){for(var s=t;s.children().length;)s=s.children().first();s.text(e.title)}},setDropdownAttr:function(i,t,s){p.each(t,function(t,e){"class"==t?s?i.removeClass(e):i.addClass(e):s?i.removeAttr(t):i.attr(t,e)})},addDropdown:function(t,e,i){void 0!==i.observe&&(i.item=t,this.opts.observe.dropdowns.push(i))},buttons:function(t,e){var o=this.selection.getCurrent(),r=this.selection.getParent();!1!==t?this.button.setInactiveAll():this.button.setInactiveAll(e),!1===t&&"html"!==e?-1!=p.inArray(e,this.opts.activeButtons)&&this.button.toggleActive(e):(p.each(this.opts.activeButtonsStates,p.proxy(function(t,e){var i=p(r).closest(t,this.$editor[0]),s=p(o).closest(t,this.$editor[0]);0!==i.length&&!this.utils.isRedactorParent(i)||!this.utils.isRedactorParent(s)||0===i.length&&0===s.closest(t,this.$editor[0]).length||this.button.setActive(e)},this)),t=p(r).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]),this.utils.isRedactorParent(r)&&t.length&&(e=""===t.css("text-align")?"left":t.css("text-align"),this.button.setActive("align"+e)))},addButton:function(t,e){this.opts.activeButtons.push(e),this.opts.activeButtonsStates[t]=e},images:function(){this.$editor.find("img").each(p.proxy(function(t,e){e=p(e);e.closest("a",this.$editor[0]).on("click",function(t){t.preventDefault()}),this.utils.browser("msie")&&e.attr("unselectable","on"),this.image.setEditable(e)},this)),p(document).on("click.redactor-image-delete."+this.uuid,p.proxy(function(t){this.observe.image=!1,"IMG"==t.target.tagName&&this.utils.isRedactorParent(t.target)&&(this.observe.image=(!this.observe.image||this.observe.image!=t.target)&&t.target)},this))},links:function(){this.opts.linkTooltip&&(this.$editor.find("a").on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,p.proxy(this.observe.showTooltip,this)),this.$editor.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,p.proxy(this.observe.closeTooltip,this)),p(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,p.proxy(this.observe.closeTooltip,this)))},getTooltipPosition:function(t){return t.offset()},showTooltip:function(t){var e,i,s,o,r,t=p(t.target);"IMG"!=t[0].tagName&&"A"===(t="A"!==t[0].tagName?t.closest("a",this.$editor[0]):t)[0].tagName&&(t=t,e=this.observe.getTooltipPosition(t),i=p('<span class="redactor-link-tooltip"></span>'),24<(s=void 0===(s=t.attr("href"))?"":s).length&&(s=s.substring(0,24)+"..."),s=p('<a href="'+t.attr("href")+'" target="_blank" />').html(s).addClass("redactor-link-tooltip-action"),o=p('<a href="#" />').html(this.lang.get("edit")).on("click",p.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),r=p('<a href="#" />').html(this.lang.get("unlink")).on("click",p.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action"),i.append(s).append(" | ").append(o).append(" | ").append(r),i.css({top:e.top+parseInt(t.css("line-height"),10)+"px",left:e.left+"px"}),p(".redactor-link-tooltip").remove(),p("body").append(i))},closeTooltip:function(t){var t=(t=t.originalEvent||t).target,e=p(t).closest("a",this.$editor[0]);0!==e.length&&"A"===e[0].tagName&&"A"!==t.tagName||"A"===t.tagName&&this.utils.isRedactorParent(t)||p(t).hasClass("redactor-link-tooltip-action")||p(".redactor-link-tooltip").remove()}}},paragraphize:function(){return{load:function(t){return this.opts.linebreaks?t:""===t||"<p></p>"===t?this.opts.emptyHtml:(t+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,t=t.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),t=this.paragraphize.getSafes(t),t=this.paragraphize.getSafesComments(t),t=this.paragraphize.replaceBreaksToNewLines(t),t=this.paragraphize.replaceBreaksToParagraphs(t),t=this.paragraphize.clear(t),(t=(t=this.paragraphize.restoreSafes(t)).replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>")).trim())},getSafes:function(i){var t=p("<div />").append(i);return t.find("blockquote p").replaceWith(function(){return p(this).append("<br />").contents()}),i=t.html(),t.find(this.opts.paragraphizeBlocks.join(", ")).each(p.proxy(function(t,e){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=e.outerHTML,i=i.replace(e.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this)),i},getSafesComments:function(i){var t=i.match(/<!--([\w\W]*?)-->/gi);return t&&p.each(t,p.proxy(function(t,e){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=e,i=i.replace(e,"\n{replace"+this.paragraphize.z+"}")},this)),i},restoreSafes:function(i){return p.each(this.paragraphize.safes,function(t,e){e=void 0!==e?e.replace(/\$/g,"&#36;"):e,i=i.replace("{replace"+t+"}",e)}),i},replaceBreaksToParagraphs:function(t){var e=t.split(new RegExp("\n","g"),-1);if(t="",e)for(var i=e.length,s=0;s<i;s++){if(!e.hasOwnProperty(s))return;-1==e[s].search("{replace")?(e[s]=e[s].replace(/<p>\n\t?<\/p>/gi,""),e[s]=e[s].replace(/<p><\/p>/gi,""),""!==e[s]&&(t+="<p>"+e[s].replace(/^\n+|\n+$/g,"")+"</p>")):t+=e[s]}return t},replaceBreaksToNewLines:function(t){return t=(t=(t=(t=(t=t.replace(/<br \/>\s*<br \/>/gi,"\n\n")).replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />")).replace(new RegExp("\r\n","g"),"\n")).replace(new RegExp("\r","g"),"\n")).replace(new RegExp("/\n\n+/"),"g","\n\n")},clear:function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>")).replace(new RegExp("<p></blockquote>","gi"),"</blockquote>")).replace(new RegExp("<p><blockquote>","gi"),"<blockquote>")).replace(new RegExp("<blockquote></p>","gi"),"<blockquote>")).replace(new RegExp("<p><p ","gi"),"<p ")).replace(new RegExp("<p><p>","gi"),"<p>")).replace(new RegExp("</p></p>","gi"),"</p>")).replace(new RegExp("<p>\\s?</p>","gi"),"")).replace(new RegExp("\n</p>","gi"),"</p>")).replace(new RegExp("<p>\t?\t?\n?<p>","gi"),"<p>")).replace(new RegExp("<p>\t*</p>","gi"),"")}}},paste:function(){return{init:function(t){this.opts.cleanOnPaste?(this.rtePaste=!0,this.buffer.set(),this.selection.save(),this.utils.saveScroll(),this.paste.createPasteBox(),p(window).on("scroll.redactor-freeze",p.proxy(function(){p(window).scrollTop(this.saveBodyScroll)},this)),setTimeout(p.proxy(function(){var t=this.$pasteBox.html();this.$pasteBox.remove(),this.selection.restore(),this.utils.restoreScroll(),this.paste.insert(t),p(window).off("scroll.redactor-freeze"),this.linkify.isEnabled()&&this.linkify.format()},this),1)):setTimeout(p.proxy(this.code.sync,this),1)},createPasteBox:function(){this.$pasteBox=p("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"}),(this.utils.browser("msie")?this.$box:0<this.$element.parents(".modal-body").length?this.$element.parents(".modal-body").first():0<this.$element.parents(".ui-dialog-content").length?this.$element.parents(".ui-dialog-content").first():p("body")).append(this.$pasteBox),this.$pasteBox.focus()},insert:function(t){t=this.core.setCallback("pasteBefore",t),t=this.utils.isSelectAll()?this.clean.onPaste(t,!1):this.clean.onPaste(t),t=this.core.setCallback("paste",t),this.utils.isSelectAll()?this.insert.set(t,!1):this.insert.html(t,!1),this.utils.disableSelectAll(),this.rtePaste=!1,setTimeout(p.proxy(this.clean.clearUnverified,this),10),setTimeout(p.proxy(function(){var t=this.$editor.find("span");p.each(t,function(t,e){""===e.innerHTML.replace(/\u200B/,"")&&0===e.attributes.length&&p(e).remove()})},this),10)}}},placeholder:function(){return{enable:function(){this.placeholder.is()&&(this.$editor.attr("placeholder",this.$element.attr("placeholder")),this.placeholder.toggle(),this.$editor.on("keydown.redactor-placeholder",p.proxy(this.placeholder.toggle,this)))},toggle:function(){setTimeout(p.proxy(function(){var t=this.utils.isEmpty(this.$editor.html(),!1)?"addClass":"removeClass";this.$editor[t]("redactor-placeholder")},this),5)},remove:function(){this.$editor.removeClass("redactor-placeholder")},is:function(){return this.opts.placeholder?this.$element.attr("placeholder",this.opts.placeholder):!(void 0===this.$element.attr("placeholder")||""===this.$element.attr("placeholder"))}}},progress:function(){return{show:function(){p(document.body).append(p('<div id="redactor-progress"><span></span></div>')),p("#redactor-progress").fadeIn()},hide:function(){p("#redactor-progress").fadeOut(1500,function(){p(this).remove()})}}},selection:function(){return{get:function(){this.sel=document.getSelection(),document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount?this.range=this.sel.getRangeAt(0):this.range=document.createRange()},addRange:function(){try{this.sel.removeAllRanges()}catch(t){}this.sel.addRange(this.range)},getCurrent:function(){var t=!1;return this.selection.get(),this.sel&&0<this.sel.rangeCount&&(t=this.sel.getRangeAt(0).startContainer),this.utils.isRedactorParent(t)},getParent:function(t){return!!(t=t||this.selection.getCurrent())&&this.utils.isRedactorParent(p(t).parent()[0])},getPrev:function(){return window.getSelection().anchorNode.previousSibling},getNext:function(){return window.getSelection().anchorNode.nextSibling},getBlock:function(t){for(t=t||this.selection.getCurrent();t;){if(this.utils.isBlockTag(t.tagName))return!p(t).hasClass("redactor-editor")&&t;t=t.parentNode}return!1},getInlines:function(t,e){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var i=[],s=(t=void 0===t||!1===t?this.selection.getNodes():t,this.opts.inlineTags);if(s.push("span"),void 0!==e)for(var o=0;o<e.length;o++)s.push(e[o]);return p.each(t,p.proxy(function(t,e){-1!=p.inArray(e.tagName.toLowerCase(),s)&&i.push(e)},this)),0!==i.length&&i},getInlinesTags:function(i){var s,t;return this.selection.get(),!(this.range&&this.range.collapsed||(s=[],t=this.selection.getNodes(),p.each(t,p.proxy(function(t,e){-1!=p.inArray(e.tagName.toLowerCase(),i)&&s.push(e)},this)),0===s.length))&&s},getBlocks:function(t){var i;return this.selection.get(),this.range&&this.range.collapsed||(i=[],t=void 0===t?this.selection.getNodes():t,p.each(t,p.proxy(function(t,e){this.utils.isBlock(e)&&(this.selection.lastBlock=e,i.push(e))},this)),0===i.length)?[this.selection.getBlock()]:i},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();for(var t,e,i,s,o,r=this.selection.getNodesMarker(1),a=this.selection.getNodesMarker(2),n=(!1===this.range.collapsed?window.getSelection&&0<(t=window.getSelection()).rangeCount&&(i=(e=t.getRangeAt(0)).startContainer,s=e.startOffset,(o=e.cloneRange()).collapse(!1),o.insertNode(a),o.setStart(i,s),o.collapse(!0),o.insertNode(r),e.setStartAfter(r),e.setEndBefore(a),t.removeAllRanges(),t.addRange(e)):(this.selection.setNodesMarker(this.range,r,!0),a=r),[]),l=0,c=this,h=(this.$editor.find("*").each(function(){var t;if(this==r?(0!==(t=p(this).parent()).length&&"BODY"!=t[0].tagName&&c.utils.isRedactorParent(t[0])&&n.push(t[0]),n.push(this),l=1):0<l&&(n.push(this),l+=1),this==a)return!1}),[]),d=n.length,u=0;u<d;u++)"nodes-marker-1"!=n[u].id&&"nodes-marker-2"!=n[u].id&&h.push(n[u]);return this.selection.removeNodesMarkers(),h},getNodesMarker:function(t){return p('<span id="nodes-marker-'+t+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},setNodesMarker:function(t,e,i){t=t.cloneRange();try{t.collapse(i),t.insertNode(e)}catch(t){}},removeNodesMarkers:function(){p(document).find("span.redactor-nodes-marker").remove(),this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(t,e){this.caret.setOffset(t,e)},wrap:function(t){return this.selection.get(),!this.range.collapsed&&((t=document.createElement(t)).appendChild(this.range.extractContents()),this.range.insertNode(t),t)},selectElement:function(t){this.utils.browser("mozilla")?(t=t[0]||t,document.createRange().selectNodeContents(t)):this.caret.set(t,0,t,1)},selectAll:function(){this.selection.get(),this.range.selectNodeContents(this.$editor[0]),this.selection.addRange()},remove:function(){this.selection.get(),this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var t,e=this.selection.getMarker(1);this.selection.setMarker(this.range,e,!0),!1===this.range.collapsed&&(t=this.selection.getMarker(2),this.selection.setMarker(this.range,t,!1),this.utils.browser("chrome"))&&this.caret.set(e,0,t,0),this.savedSel=this.$editor.html()},getMarker:function(t){return p('<span id="selection-marker-'+(t=void 0===t?1:t)+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},getMarkerAsHtml:function(t){return this.utils.getOuterHtml(this.selection.getMarker(t))},setMarker:function(t,e,i){t=t.cloneRange();try{t.collapse(i),t.insertNode(e)}catch(t){this.focus.setStart()}},restore:function(){var t=this.$editor.find("span#selection-marker-1"),e=this.$editor.find("span#selection-marker-2");this.utils.browser("mozilla")&&this.$editor.focus(),0!==t.length&&0!==e.length?this.caret.set(t,0,e,0):0!==t.length?this.caret.set(t,0,t,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(t,e){""===p(e).text().replace(/\u200B/g,"")?p(e).remove():p(e).replaceWith(function(){return p(this).contents()})})},getText:function(){return this.selection.get(),this.sel.toString()},getHtml:function(){var t="";if(this.selection.get(),this.sel.rangeCount){for(var e=document.createElement("div"),i=this.sel.rangeCount,s=0;s<i;++s)e.appendChild(this.sel.getRangeAt(s).cloneContents());t=e.innerHTML}return this.clean.onSync(t)},replaceSelection:function(t){this.selection.get(),this.range.deleteContents();for(var e,i=document.createElement("div"),s=(i.innerHTML=t,document.createDocumentFragment());e=i.firstChild;)s.appendChild(e);this.range.insertNode(s)},replaceWithHtml:function(t){t=this.selection.getMarkerAsHtml(1)+t+this.selection.getMarkerAsHtml(2),this.selection.get(),window.getSelection&&window.getSelection().getRangeAt?this.selection.replaceSelection(t):document.selection&&document.selection.createRange&&this.range.pasteHTML(t),this.selection.restore(),this.code.sync()}}},shortcuts:function(){return{init:function(r,t){if(!this.opts.shortcuts)return!r.ctrlKey&&!r.metaKey||66!==t&&73!==t||r.preventDefault(),!1;p.each(this.opts.shortcuts,p.proxy(function(t,e){for(var i=t.split(","),s=i.length,o=0;o<s;o++)"string"==typeof i[o]&&this.shortcuts.handler(r,i[o].trim(),p.proxy(function(){var t;"-1"!=e.func.search(/\./)?void 0!==this[(t=e.func.split("."))[0]]&&this[t[0]][t[1]].apply(this,e.params):this[e.func].apply(this,e.params)},this))},this))},handler:function(i,t,e){var s={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},o=(t=t.toLowerCase().split(" "),{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}[i.keyCode]),r=String.fromCharCode(i.which).toLowerCase(),a="",n={};p.each(["alt","ctrl","meta","shift"],function(t,e){i[e+"Key"]&&o!==e&&(a+=e+"+")}),o&&(n[a+o]=!0),r&&(n[a+r]=!0,n[a+s[r]]=!0,"shift+"===a)&&(n[s[r]]=!0);for(var l=0,c=t.length;l<c;l++)if(n[t[l]])return i.preventDefault(),e.apply(this,arguments)}}},tabifier:function(){return{get:function(t){if(!this.opts.tabifier)return t;var e=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],i=["li","dt","dt","h[1-6]","option","script"],s=(this.tabifier.lineBefore=new RegExp("^<(/?"+e.join("|/?")+"|"+i.join("|")+")[ >]"),this.tabifier.lineAfter=new RegExp("^<(br|/?"+e.join("|/?")+"|/"+i.join("|/")+")[ >]"),this.tabifier.newLevel=new RegExp("^</?("+["p","blockquote","div","dl","fieldset","form","frameset","map","ol","pre","select","td","th","tr","ul"].join("|")+")[ >]"),0),o=t.length,r=0,a="",n="",l="";for(this.tabifier.cleanlevel=0;s<o;s++){if(r=s,-1==t.substr(s).indexOf("<"))return n+=t.substr(s),this.tabifier.finish(n);for(;r<o&&"<"!=t.charAt(r);)r++;for(s!=r&&((l=t.substr(s,r-s)).match(/^\s{2,}$/g)||("\n"==n.charAt(n.length-1)?n+=this.tabifier.getTabs():"\n"==l.charAt(0)&&(n+="\n"+this.tabifier.getTabs(),l=l.replace(/^\s+/,"")),n+=l),l.match(/\n/))&&(n+="\n"+this.tabifier.getTabs()),c=r;r<o&&">"!=t.charAt(r);)r++;var c,s=r;if("!--"==(a=t.substr(c,r-c)).substr(1,3)){if(!a.match(/--$/)){for(;"--\x3e"!=t.substr(r,3);)r++;r+=2,a=t.substr(c,r-c),s=r}"\n"!=n.charAt(n.length-1)&&(n+="\n"),n=n+this.tabifier.getTabs()+(a+">\n")}else"!"==a[1]?n=this.tabifier.placeTag(a+">",n):"?"==a[1]?n+=a+">\n":(c=a.match(/^<(script|style|pre)/i))?(c[1]=c[1].toLowerCase(),a=this.tabifier.cleanTag(a),n=this.tabifier.placeTag(a,n),(c=String(t.substr(s+1)).toLowerCase().indexOf("</"+c[1]))&&(l=t.substr(s+1,c),s+=c,n+=l)):(a=this.tabifier.cleanTag(a),n=this.tabifier.placeTag(a,n))}return this.tabifier.finish(n)},getTabs:function(){for(var t="",e=0;e<this.tabifier.cleanlevel;e++)t+="\t";return t},finish:function(t){return t=(t=(t=(t=t.replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/,"")).replace(/[\s\n]*$/,"")).replace(/<script(.*?)>\n<\/script>/gi,"<script$1><\/script>"),this.tabifier.cleanlevel=0,t},cleanTag:function(t){var e,i="",s="";for((t=(t=(t=t.replace(/\n/g," ")).replace(/\s{2,}/g," ")).replace(/^\s+|\s+$/g," ")).match(/\/$/)&&(s="/",t=t.replace(/\/+$/,""));e=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(t);)e[2]?i+=e[1].toLowerCase()+"="+e[2]:e[1]&&(i+=e[1].toLowerCase()),i+=" ",t=t.substr(e[0].length);return i.replace(/\s*$/,"")+s+">"},placeTag:function(t,e){var i=t.match(this.tabifier.newLevel);return(t.match(this.tabifier.lineBefore)||i)&&(e=e.replace(/\s*$/,""),e+="\n"),i&&"/"==t.charAt(1)&&this.tabifier.cleanlevel--,"\n"==e.charAt(e.length-1)&&(e+=this.tabifier.getTabs()),i&&"/"!=t.charAt(1)&&this.tabifier.cleanlevel++,e+=t,e=t.match(this.tabifier.lineAfter)||t.match(this.tabifier.newLevel)?e.replace(/ *$/,""):e}}},tidy:function(){return{setupAllowed:function(){var t;this.opts.allowedTags&&(this.opts.deniedTags=!1),this.opts.allowedAttr&&(this.opts.removeAttr=!1),this.opts.linebreaks||(t=["p","section"],this.opts.allowedTags&&this.tidy.addToAllowed(t),this.opts.deniedTags&&this.tidy.removeFromDenied(t))},addToAllowed:function(t){for(var e=t.length,i=0;i<e;i++)-1==p.inArray(t[i],this.opts.allowedTags)&&this.opts.allowedTags.push(t[i])},removeFromDenied:function(t){for(var e=t.length,i=0;i<e;i++){var s=p.inArray(t[i],this.opts.deniedTags);-1!=s&&this.opts.deniedTags.splice(s,1)}},load:function(t,e){return this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty},p.extend(this.tidy.settings,e),t=this.tidy.removeComments(t),this.tidy.$div=p("<div />").append(t),this.tidy.replaceTags(),this.tidy.replaceStyles(),this.tidy.removeTags(),this.tidy.removeAttr(),this.tidy.removeEmpty(),this.tidy.removeParagraphsInLists(),this.tidy.removeDataAttr(),this.tidy.removeWithoutAttr(),t=this.tidy.$div.html(),this.tidy.$div.remove(),t},removeComments:function(t){return this.tidy.settings.removeComments?t.replace(/<!--[\s\S]*?-->/gi,""):t},replaceTags:function(t){if(!this.tidy.settings.replaceTags)return t;for(var e=this.tidy.settings.replaceTags.length,i=[],s=[],o=0;o<e;o++)s.push(this.tidy.settings.replaceTags[o][1]),i.push(this.tidy.settings.replaceTags[o][0]);p.each(i,p.proxy(function(t,e){this.tidy.$div.find(e).replaceWith(function(){return p("<"+s[t]+" />",{html:p(this).html()})})},this))},replaceStyles:function(){var a;this.tidy.settings.replaceStyles&&(a=this.tidy.settings.replaceStyles.length,this.tidy.$div.find("span").each(p.proxy(function(t,e){for(var i,s=p(e),o=s.attr("style"),r=0;r<a;r++)o&&o.match(new RegExp("^"+this.tidy.settings.replaceStyles[r][0],"i"))&&(i=this.tidy.settings.replaceStyles[r][1],s.replaceWith(function(){var t=document.createElement(i);return p(t).append(p(this).contents())}))},this)))},removeTags:function(){!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags&&this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(t,e){""===e.innerHTML?p(e).remove():p(e).contents().unwrap()}),this.tidy.settings.deniedTags&&this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(t,e){p(e).hasClass("redactor-script-tag")||p(e).hasClass("redactor-selection-marker")||(""===e.innerHTML?p(e).remove():p(e).contents().unwrap())})},removeAttr:function(){if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){for(var s=[],o=[],t=this.tidy.settings.allowedAttr.length,e=0;e<t;e++)s.push(this.tidy.settings.allowedAttr[e][0]),o.push(this.tidy.settings.allowedAttr[e][1]);this.tidy.$div.find("*").each(p.proxy(function(t,e){var i=p(e),e=p.inArray(i[0].tagName.toLowerCase(),s),e=this.tidy.removeAttrGetRemoves(e,o,i);e&&p.each(e,function(t,e){i.removeAttr(e)})},this))}if(this.tidy.settings.removeAttr){t=this.tidy.settings.removeAttr.length;for(e=0;e<t;e++){var i=this.tidy.settings.removeAttr[e][1];p.isArray(i)&&(i=i.join(" ")),this.tidy.$div.find(this.tidy.settings.removeAttr[e][0]).removeAttr(i)}}},removeAttrGetRemoves:function(i,s,t){var o=[];return-1==i?p.each(t[0].attributes,function(t,e){o.push(e.name)}):"*"==s[i]?o=[]:p.each(t[0].attributes,function(t,e){p.isArray(s[i])?-1==p.inArray(e.name,s[i])&&o.push(e.name):s[i]!=e.name&&o.push(e.name)}),o},removeAttrs:function(t,s){return s=new RegExp(s,"g"),t.each(function(){for(var t=p(this),e=this.attributes.length-1;0<=e;e--){var i=this.attributes[e];i&&i.specified&&0<=i.name.search(s)&&t.removeAttr(i.name)}})},removeEmpty:function(){this.tidy.settings.removeEmpty&&this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var t=p(this),e=t.text();""===(e=(e=(e=e.replace(/\u200B/g,"")).replace(/&nbsp;/gi,"")).replace(/\s/g,""))&&0===t.children().length&&t.remove()})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){var t;this.tidy.settings.removeDataAttr&&(t=this.tidy.settings.removeDataAttr,p.isArray(this.tidy.settings.removeDataAttr)&&(t=this.tidy.settings.removeDataAttr.join(",")),this.tidy.removeAttrs(this.tidy.$div.find(t),"^(data-)"))},removeWithoutAttr:function(){this.tidy.settings.removeWithoutAttr&&this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){0===this.attributes.length&&p(this).contents().unwrap()})}}},toolbar:function(){return{init:function(){return{html:{title:this.lang.get("html"),func:"code.toggle"},formatting:{title:this.lang.get("formatting"),dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("header1"),func:"block.format"},h2:{title:this.lang.get("header2"),func:"block.format"},h3:{title:this.lang.get("header3"),func:"block.format"},h4:{title:this.lang.get("header4"),func:"block.format"},h5:{title:this.lang.get("header5"),func:"block.format"},h6:{title:this.lang.get("header6"),func:"block.format"}}},bold:{title:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline"),func:"inline.format"},unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease"},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase"},image:{title:this.lang.get("image"),func:"image.show"},file:{title:this.lang.get("file"),func:"file.show"},link:{title:this.lang.get("link"),dropdown:{link:{title:this.lang.get("link_insert"),func:"link.show",observe:{element:"a",in:{title:this.lang.get("link_edit")},out:{title:this.lang.get("link_insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},alignment:{title:this.lang.get("alignment"),dropdown:{left:{title:this.lang.get("align_left"),func:"alignment.left"},center:{title:this.lang.get("align_center"),func:"alignment.center"},right:{title:this.lang.get("align_right"),func:"alignment.right"},justify:{title:this.lang.get("align_justify"),func:"alignment.justify"}}},horizontalrule:{title:this.lang.get("horizontalrule"),func:"line.insert"}}},build:function(){this.toolbar.hideButtons(),this.toolbar.hideButtonsOnMobile(),this.toolbar.isButtonSourceNeeded(),0!==this.opts.buttons.length&&(this.$toolbar=this.toolbar.createContainer(),this.toolbar.setOverflow(),this.toolbar.append(),this.toolbar.setFormattingTags(),this.toolbar.loadButtons(),this.toolbar.setFixed(),this.opts.activeButtons)&&this.$editor.on("mouseup.redactor keyup.redactor focus.redactor",p.proxy(this.observe.toolbar,this))},createContainer:function(){return p("<ul>").addClass("redactor-toolbar").attr({id:"redactor-toolbar-"+this.uuid})},setFormattingTags:function(){p.each(this.opts.toolbar.formatting.dropdown,p.proxy(function(t,e){-1==p.inArray(t,this.opts.formatting)&&delete this.opts.toolbar.formatting.dropdown[t]},this))},loadButtons:function(){p.each(this.opts.buttons,p.proxy(function(t,e){var i;this.opts.toolbar[e]&&(i=this.opts.toolbar[e],this.$toolbar.append(p("<li>").append(this.button.build(e,i))))},this))},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),p(this.opts.toolbarExternal).html(this.$toolbar)):this.$box.prepend(this.$toolbar)},setFixed:function(){!this.utils.isDesktop()||this.opts.toolbarExternal||this.opts.toolbarFixed&&(this.toolbar.observeScroll(),p(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,p.proxy(this.toolbar.observeScroll,this)))},setOverflow:function(){this.utils.isMobile()&&this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},isButtonSourceNeeded:function(){var t;this.opts.source||-1!==(t=this.opts.buttons.indexOf("html"))&&this.opts.buttons.splice(t,1)},hideButtons:function(){0!==this.opts.buttonsHide.length&&p.each(this.opts.buttonsHide,p.proxy(function(t,e){e=this.opts.buttons.indexOf(e);this.opts.buttons.splice(e,1)},this))},hideButtonsOnMobile:function(){this.utils.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&p.each(this.opts.buttonsHideOnMobile,p.proxy(function(t,e){e=this.opts.buttons.indexOf(e);this.opts.buttons.splice(e,1)},this))},observeScroll:function(){var t=p(this.opts.toolbarFixedTarget).scrollTop(),e=1;this.opts.toolbarFixedTarget===document&&(e=this.$box.offset().top),t+this.opts.toolbarFixedTopOffset>e?this.toolbar.observeScrollEnable(t,e):this.toolbar.observeScrollDisable()},observeScrollEnable:function(t,e){var i=this.opts.toolbarFixedTopOffset+t-e,e=e+this.$box.height()-32,s=this.$box.innerWidth();this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:"absolute",width:s,top:i+"px",left:0}),e<t&&p(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",t<e?"visible":"hidden")},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box")},setDropdownsFixed:function(){var t=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,e="fixed";this.opts.toolbarFixedTarget!==document&&(t=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,e="absolute"),p(".redactor-dropdown-"+this.uuid).each(function(){p(this).css({position:e,top:t+"px"})})},unsetDropdownsFixed:function(){var t=this.$toolbar.innerHeight()+this.$toolbar.offset().top;p(".redactor-dropdown-"+this.uuid).each(function(){p(this).css({position:"absolute",top:t+"px"})})}}},upload:function(){return{init:function(t,e,i){this.upload.direct=!1,this.upload.callback=i,this.upload.url=e,this.upload.$el=p(t),this.upload.$droparea=p('<div id="redactor-droparea" />'),this.upload.$placeholdler=p('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload_label")),this.upload.$input=p('<input type="file" name="file" />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",p.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",p.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",p.proxy(function(t){t=t.originalEvent||t,this.upload.traverseFile(this.upload.$input[0].files[0],t)},this)),this.upload.$droparea.on("drop.redactor.upload",p.proxy(function(t){t.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(t)},this))},directUpload:function(t,e){this.upload.direct=!0,this.upload.traverseFile(t,e)},onDrop:function(t){var e=(t=t.originalEvent||t).dataTransfer.files;this.upload.traverseFile(e[0],t)},traverseFile:function(t,e){var i,s;this.opts.s3?(this.upload.setConfig(t),this.upload.s3uploadFile(t)):(i=window.FormData?new FormData:null,window.FormData&&(this.upload.setConfig(t),s="image"==this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam,i.append(s,t)),this.progress.show(),this.core.setCallback("uploadStart",e,i),this.upload.sendData(i,e))},setConfig:function(t){this.upload.getType(t),this.upload.direct&&(this.upload.url="image"==this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback=("image"==this.upload.type?this.image:this.file).insert)},getType:function(t){this.upload.type="image",-1==this.opts.imageTypes.indexOf(t.type)&&(this.upload.type="file")},getHiddenFields:function(t,i){return!1!==t&&"object"==typeof t&&p.each(t,p.proxy(function(t,e){null!==e&&0===e.toString().indexOf("#")&&(e=p(e).val()),i.append(t,e)},this)),i},sendData:function(t,i){t="image"==this.upload.type?(t=this.upload.getHiddenFields(this.opts.uploadImageFields,t),this.upload.getHiddenFields(this.upload.imageFields,t)):(t=this.upload.getHiddenFields(this.opts.uploadFileFields,t),this.upload.getHiddenFields(this.upload.fileFields,t));var s=new XMLHttpRequest;s.open("POST",this.upload.url),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.onreadystatechange=p.proxy(function(){if(4==s.readyState){var e,t=s.responseText;t=(t=t.replace(/^\[/,"")).replace(/\]$/,"");try{e="string"==typeof t?p.parseJSON(t):t}catch(t){e={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(e,this.upload.direct,i)}},this),s.send(t)},onDrag:function(t){t.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(t){t.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(t,e){this.upload.imageFields[t]=e},removeImageFields:function(t){delete this.upload.imageFields[t]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(t,e){this.upload.fileFields[t]=e},removeFileFields:function(t){delete this.upload.fileFields[t]},s3uploadFile:function(e){this.upload.s3executeOnSignedUrl(e,p.proxy(function(t){this.upload.s3uploadToS3(e,t)},this))},s3executeOnSignedUrl:function(t,e){var i=new XMLHttpRequest,s="?",o=("-1"!=this.opts.s3.search(/\?/)&&(s="&"),i.open("GET",this.opts.s3+s+"name="+t.name+"&type="+t.type,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),this);i.onreadystatechange=function(t){4==this.readyState&&200==this.status?(o.progress.show(),e(decodeURIComponent(this.responseText))):4==this.readyState&&this.status},i.send()},s3createCORSRequest:function(t,e){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest).open(t,e):i=null,i},s3uploadToS3:function(t,i){var s=this.upload.s3createCORSRequest("PUT",i);s&&(s.onload=p.proxy(function(){if(200==s.status){this.progress.hide();var t=i.split("?");if(!t[0])return!1;this.upload.direct||this.upload.$droparea.removeClass("drag-drop");var e={filelink:t[0]};"file"==this.upload.type&&(t=t[0].split("/"),e.filename=t[t.length-1]),this.upload.callback(e,this.upload.direct,!1)}},this),s.onerror=function(){},s.upload.onprogress=function(t){},s.setRequestHeader("Content-Type",t.type),s.setRequestHeader("x-amz-acl","public-read"),s.send(t))}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(t){return"[object String]"==Object.prototype.toString.call(t)},isEmpty:function(t,e){return t=(t=(t=(t=(t=(t=(t=t.replace(/[\u200B-\u200D\uFEFF]/g,"")).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source"),""===(t=(t=!1!==e?(t=t.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,""):t).trim())},normalize:function(t){return void 0===t?0:parseInt(t.replace("px",""),10)},hexToRgb:function(t){if(void 0!==t)return-1==t.search(/^#/)?t:(t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,s){return e+e+i+i+s+s}),t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),"rgb("+parseInt(t[1],16)+", "+parseInt(t[2],16)+", "+parseInt(t[3],16)+")")},getOuterHtml:function(t){return p("<div>").append(p(t).eq(0).clone()).html()},getAlignmentElement:function(t){return-1!==p.inArray(t.tagName,this.opts.alignmentTags)?p(t):p(t).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])},removeEmptyAttr:function(t,e){t=p(t);return void 0===t.attr(e)||""===t.attr(e)&&(t.removeAttr(e),!0)},removeEmpty:function(t,e){var i,e=p(p.parseHTML(e));e.find(".redactor-invisible-space").removeAttr("style").removeAttr("class"),0===e.find("hr, br, img, iframe, source").length&&(i=e.text().trim(),this.utils.isEmpty(i,!1))&&e.remove()},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop(),this.saveBodyScroll=p(window).scrollTop(),this.opts.scrollTarget&&(this.saveTargetScroll=p(this.opts.scrollTarget).scrollTop())},restoreScroll:function(){void 0===this.saveScroll&&void 0===this.saveBodyScroll||(p(window).scrollTop(this.saveBodyScroll),this.$editor.scrollTop(this.saveEditorScroll),this.opts.scrollTarget&&p(this.opts.scrollTarget).scrollTop(this.saveTargetScroll))},createSpaceElement:function(){var t=document.createElement("span");return t.className="redactor-invisible-space",t.innerHTML=this.opts.invisibleSpace,t},removeInlineTags:function(t){var e=this.opts.inlineTags;e.push("span"),"PRE"==t.tagName&&e.push("a"),p(t).find(e.join(",")).not("span.redactor-selection-marker").contents().unwrap()},replaceWithContents:function(t,e){var i=this;return p(t).replaceWith(function(){return!0===e&&i.utils.removeInlineTags(this),p(this).contents()}),p(t)},replaceToTag:function(t,e,i){var s,o=this;return p(t).replaceWith(function(){s=p("<"+e+" />").append(p(this).contents());for(var t=0;t<this.attributes.length;t++)s.attr(this.attributes[t].name,this.attributes[t].value);return!0===i&&o.utils.removeInlineTags(s),s}),s},isStartOfElement:function(){var t=this.selection.getBlock();return!!t&&0===this.caret.getOffsetOfElement(t)},isEndOfElement:function(t){if(void 0===t&&!(t=this.selection.getBlock()))return!1;return this.caret.getOffsetOfElement(t)==p(t).text().trim().replace(/\n\r\n/g,"").length},isEndOfEditor:function(){var t=this.$editor[0];return this.caret.getOffsetOfElement(t)==p(t).html().replace(/(<([^>]+)>)/gi,"").trim().length},isBlock:function(t){return(t=t[0]||t)&&this.utils.isBlockTag(t.tagName)},isBlockTag:function(t){return void 0!==t&&this.reIsBlock.test(t)},isTag:function(t,e){t=p(t).closest(e,this.$editor[0]);return 1==t.length&&t[0]},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},isRedactorParent:function(t){return!!t&&0!==p(t).parents(".redactor-editor").length&&!p(t).hasClass("redactor-editor")&&t},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(t){var i,s=this.selection.getParent(),o=this.selection.getCurrent();return p.isArray(t)?(i=0,p.each(t,p.proxy(function(t,e){this.utils.isCurrentOrParentOne(o,s,e)&&i++},this)),0!==i):this.utils.isCurrentOrParentOne(o,s,t)},isCurrentOrParentOne:function(t,e,i){return i=i.toUpperCase(),e&&e.tagName===i?e:!(!t||t.tagName!==i)&&t},isOldIe:function(){return!!(this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9)},isLessIe10:function(){return!!(this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10)},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(t){var e=navigator.userAgent.toLowerCase(),e=/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0<=e.indexOf("trident")&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return"safari"==t?void 0!==e[3]&&"safari"==e[3]:"version"==t?e[2]:"webkit"==t?"chrome"==e[1]||"opr"==e[1]||"webkit"==e[1]:"rv"==e[1]?"msie"==t:"opr"==e[1]?"webkit"==t:t==e[1]},strpos:function(t,e,i){t=t.indexOf(e,i);return 0<=t&&t},disableBodyScroll:function(){var t=p("html"),e=window.innerWidth,i=(e||(e=(i=document.documentElement.getBoundingClientRect()).right-Math.abs(i.left)),document.body.clientWidth<e),e=this.utils.measureScrollbar();t.css("overflow","hidden"),i&&t.css("padding-right",e)},measureScrollbar:function(){var t=p("body"),e=document.createElement("div"),i=(e.className="redactor-scrollbar-measure",t.append(e),e.offsetWidth-e.clientWidth);return t[0].removeChild(e),i},enableBodyScroll:function(){p("html").css({overflow:"","padding-right":""}),p("body").remove("redactor-scrollbar-measure")}}}},p(window).on("load.tools.redactor",function(){p('[data-tools="redactor"]').redactor()}),a.prototype.init.prototype=a.prototype}(jQuery),RedactorPlugins=RedactorPlugins||{},function(h){RedactorPlugins.fontcolor=function(){return{init:function(){for(var t=["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],e=["fontcolor","backcolor"],i=0;i<2;i++){var s=e[i],o=this.button.add(s,this.lang.get(s)),o=this.button.addDropdown(o);o.width(242),this.fontcolor.buildPicker(o,s,t)}this.button.setAwesome("fontcolor","fa fa-tint"),this.button.setAwesome("backcolor","fa fa-tint re-inverse"),this.button.get("backcolor").parent().addClass("ccm-inline-toolbar-inverse-cell")},buildPicker:function(t,e,i){function s(t){t.preventDefault(),a.fontcolor.set(h(this).data("rule"),h(this).attr("rel"))}for(var o="backcolor"==e?"background-color":"color",r=i.length,a=this,n=0;n<r;n++){var l=i[n],c=h('<a rel="'+l+'" data-rule="'+o+'" href="#" style="float: left; font-size: 0; border: 2px solid #fff; padding: 0; margin: 0; width: 22px; height: 22px;"></a>');c.css("background-color",l),c.on("click",s),t.append(c)}e=h('<a href="#" style="display: block; clear: both; padding: 5px; font-size: 12px; line-height: 1;"></a>').html(this.lang.get("none"));e.on("click",h.proxy(function(t){t.preventDefault(),this.fontcolor.remove(o)},this)),t.append(e)},set:function(t,e){this.inline.format("span","style",t+": "+e+";")},remove:function(t){this.inline.removeStyleRule(t)}}}}(jQuery),RedactorPlugins=RedactorPlugins||{},function(e){RedactorPlugins.fontfamily=function(){return{init:function(){var i=this,s={},t=(e.each(["Arial","Helvetica","Georgia","Times New Roman","Monospace"],function(t,e){s["s"+t]={title:e,func:function(){i.fontfamily.set(e)}}}),s.remove={title:this.lang.get("remove_font_family"),func:i.fontfamily.reset},this.button.add("fontfamily",this.lang.get("change_font_family")));this.button.setAwesome("fontfamily","fa fa-font"),this.button.addDropdown(t,s)},set:function(t){this.inline.format("span","style","font-family:"+t+";")},reset:function(){this.inline.removeStyleRule("font-family")}}}}(jQuery),RedactorPlugins=RedactorPlugins||{},function(e){RedactorPlugins.fontsize=function(){return{init:function(){var i=this,s={},t=(e.each([10,11,12,14,16,18,20,24,28,30],function(t,e){s["s"+t]={title:e+"px",func:function(){i.fontsize.set(e)}}}),s.remove={title:this.lang.get("remove_font_size"),func:i.fontsize.reset},this.button.add("fontsize",this.lang.get("change_font_size")));this.button.setAwesome("fontsize","fa fa-text-height"),this.button.addDropdown(t,s)},set:function(t){this.inline.format("span","style","font-size: "+t+"px;")},reset:function(){this.inline.removeStyleRule("font-size")}}}}(jQuery),RedactorPlugins=RedactorPlugins||{},function(h){RedactorPlugins.table=function(){return{getTemplate:function(){return String()+'<section id="redactor-modal-table-insert"><div class="form-group"><label class="control-label">'+this.lang.get("rows")+'</label><input type="text" size="5" value="2" class="form-control" id="redactor-table-rows" /></div><div class="form-group"><label class="control-label">'+this.lang.get("columns")+'</label><input type="text" size="5" value="3" class="form-control" id="redactor-table-columns" /></div></section>'},init:function(){var t={},e=(t.insert_table={title:this.lang.get("insert_table"),func:this.table.show},t.insert_row_above={title:this.lang.get("insert_row_above"),func:this.table.addRowAbove},t.insert_row_below={title:this.lang.get("insert_row_below"),func:this.table.addRowBelow},t.insert_column_left={title:this.lang.get("insert_column_left"),func:this.table.addColumnLeft},t.insert_column_right={title:this.lang.get("insert_column_right"),func:this.table.addColumnRight},t.add_head={title:this.lang.get("add_head"),func:this.table.addHead},t.delete_head={title:this.lang.get("delete_head"),func:this.table.deleteHead},t.delete_column={title:this.lang.get("delete_column"),func:this.table.deleteColumn},t.delete_row={title:this.lang.get("delete_row"),func:this.table.deleteRow},t.delete_table={title:this.lang.get("delete_table"),func:this.table.deleteTable},this.observe.addButton("td","table"),this.observe.addButton("th","table"),this.button.addBefore("link","table",this.lang.get("table")));this.button.setAwesome("table","fa fa-table"),this.button.addDropdown(e,t)},show:function(){this.modal.addTemplate("table",this.table.getTemplate()),this.modal.load("table",this.lang.get("insert_table"),300),this.modal.createCancelButton(),this.modal.createActionButton(this.lang.get("insert")).on("click",this.table.insert),this.selection.save(),this.modal.show(),h("#redactor-table-rows").focus()},insert:function(){for(var t,e,i,s=h("#redactor-table-rows").val(),o=h("#redactor-table-columns").val(),r=h("<div>"),a=Math.floor(99999*Math.random()),n=h('<table id="table'+a+'"><tbody></tbody></table>'),l=0;l<s;l++){for(t=h("<tr>"),e=0;e<o;e++)i=h("<td>"+this.opts.invisibleSpace+"</td>"),0===l&&0===e&&i.append(this.selection.getMarker()),h(t).append(i);n.append(t)}r.append(n);var c,r=r.html();this.modal.close(),this.selection.restore(),this.table.getTable()||(this.buffer.set(),(c=this.selection.getBlock()||this.selection.getCurrent())&&"BODY"!=c.tagName?("LI"==c.tagName&&(c=h(c).closest("ul, ol")),h(c).after(r)):this.insert.html(r),this.selection.restore(),c=this.$editor.find("#table"+a),this.opts.linebreaks||!this.utils.browser("mozilla")&&!this.utils.browser("msie")||0===c.next().length&&c.after(this.opts.emptyHtml),this.observe.buttons(),c.find("span.redactor-selection-marker").remove(),c.removeAttr("id"),this.code.sync(),this.core.setCallback("insertedTable",c))},getTable:function(){var t=h(this.selection.getParent()).closest("table");return!!this.utils.isRedactorParent(t)&&0!==t.size()&&t},restoreAfterDelete:function(t){this.selection.restore(),t.find("span.redactor-selection-marker").remove(),this.code.sync()},deleteTable:function(){var t,e=this.table.getTable();e&&(this.buffer.set(),t=e.next(),this.opts.linebreaks||0===t.length?this.caret.setAfter(e):this.caret.setStart(t),e.remove(),this.code.sync())},deleteRow:function(){var t,e,i=this.table.getTable();i&&(t=h(this.selection.getCurrent()),this.buffer.set(),(e=(t=t.closest("tr")).prev().length?t.prev():t.next()).length&&(e=e.children("td, th").first()).length&&e.prepend(this.selection.getMarker()),t.remove(),this.table.restoreAfterDelete(i))},deleteColumn:function(){var s,t=this.table.getTable();t&&(this.buffer.set(),s=h(this.selection.getCurrent()).closest("td, th")[0].cellIndex,t.find("tr").each(h.proxy(function(t,e){var e=h(e),i=s-1<0?s+1:s-1;0===t&&e.find("td, th").eq(i).prepend(this.selection.getMarker()),e.find("td, th").eq(s).remove()},this)),this.table.restoreAfterDelete(t))},addHead:function(){var t,e=this.table.getTable();e&&(this.buffer.set(),0!==e.find("thead").size()?this.table.deleteHead():((t=e.find("tr").first().clone()).find("td").replaceWith(h.proxy(function(){return h("<th>").html(this.opts.invisibleSpace)},this)),$thead=h("<thead></thead>").append(t),e.prepend($thead),this.code.sync()))},deleteHead:function(){var t=this.table.getTable();t&&0!==(t=t.find("thead")).size()&&(this.buffer.set(),t.remove(),this.code.sync())},addRowAbove:function(){this.table.addRow("before")},addRowBelow:function(){this.table.addRow("after")},addColumnLeft:function(){this.table.addColumn("before")},addColumnRight:function(){this.table.addColumn("after")},addRow:function(t){var e,i;this.table.getTable()&&(this.buffer.set(),(i=(e=h(this.selection.getCurrent()).closest("tr")).clone()).find("th").replaceWith(function(){var t=h("<td>");return t[0].attributes=this.attributes,t.append(h(this).contents())}),i.find("td").html(this.opts.invisibleSpace),"after"==t?e.after(i):e.before(i),this.code.sync())},addColumn:function(s){var o,t,e,i,r=this.table.getTable();r&&(o=0,t=h(this.selection.getCurrent()),this.buffer.set(),e=t.closest("tr"),i=t.closest("td, th"),e.find("td, th").each(h.proxy(function(t,e){h(e)[0]===i[0]&&(o=t)},this)),r.find("tr").each(h.proxy(function(t,e){var e=h(e).find("td, th").eq(o),i=e.clone();i.html(this.opts.invisibleSpace),"after"==s?e.after(i):e.before(i)},this)),this.code.sync())}}}}(jQuery),(RedactorPlugins=void 0===RedactorPlugins?{}:RedactorPlugins).undoredo=function(){return{init:function(){var t=this.button.addFirst("undo",this.lang.get("undo")),e=this.button.addAfter("undo","redo",this.lang.get("redo"));this.button.setAwesome("undo","fa-undo"),this.button.setAwesome("redo","fa-undo fa-flip-horizontal"),this.button.addCallback(t,this.buffer.undo),this.button.addCallback(e,this.buffer.redo)}}},(RedactorPlugins=void 0===RedactorPlugins?{}:RedactorPlugins).concrete5lightbox=function(){return{init:function(){this.opts.concrete5.lightbox=!0}}},(RedactorPlugins=void 0===RedactorPlugins?{}:RedactorPlugins).underline=function(){return{init:function(){this.button.addAfter("italic","underline",this.lang.get("underline")),$btn=this.button.get("underline"),this.button.addCallback($btn,this.underline.format),this.button.setAwesome("underline","fa fa-underline")},format:function(t){this.button.get("underline").hasClass("redactor-act")?this.inline.removeFormat("u"):this.inline.format("u")}}},(RedactorPlugins=void 0===RedactorPlugins?{}:RedactorPlugins).concrete5inline=function(){return{init:function(){var t=this,e=(this.$toolbar.addClass("ccm-inline-toolbar"),this.$toolbar.append($('<li class="ccm-inline-toolbar-button ccm-inline-toolbar-button-cancel"><button id="ccm-redactor-cancel-button" type="button" class="btn btn-mini">'+this.lang.get("cancel")+'</button></li><li class="ccm-inline-toolbar-button ccm-inline-toolbar-button-save"><button id="ccm-redactor-save-button" type="button" class="btn btn-primary btn-mini">'+this.lang.get("save")+"</button></li>")),this.$toolbar);$("#ccm-redactor-cancel-button").unbind().on("click",function(){e.hide(),$("li#ccm-redactor-actions-buttons").hide(),ConcreteEvent.fire("EditModeExitInline")}),$("#ccm-redactor-save-button").unbind().on("click",function(){$("#redactor-content").val(t.code.get()),e.hide(),ConcreteEvent.fire("EditModeBlockSaveInline")})}}},(RedactorPlugins=void 0===RedactorPlugins?{}:RedactorPlugins).concrete5magic=function(){return{styles:[],createButton:function(t){var e;t=t||[],this.concrete5magic;this.button.remove("styles"),e=this.button.get("formatting").length?this.button.addAfter("formatting","styles",this.lang.get("customStyles"),!1,t):this.button.add("styles",this.lang.get("customStyles"),!1,t),this.button.setAwesome("styles","fa-magic"),this.button.addDropdown(e,t)},init:function(){var o=this.concrete5magic,r=this;$.ajax({type:"get",dataType:"json",url:CCM_DISPATCHER_FILENAME+"/ccm/system/backend/editor_data",data:{ccm_token:CCM_EDITOR_SECURITY_TOKEN,cID:CCM_CID},success:function(t){var i={};o.snippetsByHandle={},$.each(t.snippets,function(t,e){o.snippetsByHandle[e.scsHandle]={scsHandle:e.scsHandle,scsName:e.scsName},i[e.scsHandle]={title:e.scsName,func:function(t,e,i,s){t=o.snippetsByHandle[t],t=String()+'<span class="ccm-content-editor-snippet" contenteditable="false" data-scsHandle="'+t.scsHandle+'">'+t.scsName+"</span>";r.insert.htmlWithoutClean(t)}}}),r.button.get("styles");r.styles=t.classes,jQuery.each(t.classes,function(t,e){i["s"+t]={title:e.title,className:e.menuClass,func:function(){o.setCustomFormat(e)}}}),i.remove={title:r.lang.get("remove_style"),func:function(){o.resetCustomFormat()}},o.createButton(i)}}),o.createButton()},setCustomFormat:function(t){-1==t.forceBlock||1!=t.forceBlock&&(!t.wrap||-1<jQuery.inArray(t.wrap,["a","em","strong","small","s","cite","q","dfn","abbr","data","time","var","samp","kbd","i","b","u","mark","ruby","rt","rp","bdi","bdo","span","sub","sup","code"]))?(t.wrap&&this.inline.format(t.wrap),t.style&&this.block.setAttr("style",t.style),t.spanClass&&this.inline.toggleClass(t.spanClass)):(t.wrap&&this.selection.wrap(t.wrap),t.style&&this.block.setAttr("style",t.style),t.spanClass&&this.block.setClass(t.spanClass))},resetCustomFormat:function(){var i=this;jQuery.each(this.styles,function(t,e){e.spanClass&&(i.inline.removeFormat(),i.block.removeClass(e.spanClass))})}}},(RedactorPlugins=RedactorPlugins||{}).specialcharacters=function(){return{entities:[["&nbsp;","&#160;",!0,"no-break space"],["&amp;","&#38;",!0,"ampersand"],["&quot;","&#34;",!0,"quotation mark"],["&cent;","&#162;",!0,"cent sign"],["&euro;","&#8364;",!0,"euro sign"],["&pound;","&#163;",!0,"pound sign"],["&yen;","&#165;",!0,"yen sign"],["&copy;","&#169;",!0,"copyright sign"],["&reg;","&#174;",!0,"registered sign"],["&trade;","&#8482;",!0,"trade mark sign"],["&permil;","&#8240;",!0,"per mille sign"],["&micro;","&#181;",!0,"micro sign"],["&middot;","&#183;",!0,"middle dot"],["&bull;","&#8226;",!0,"bullet"],["&hellip;","&#8230;",!0,"three dot leader"],["&prime;","&#8242;",!0,"minutes / feet"],["&Prime;","&#8243;",!0,"seconds / inches"],["&sect;","&#167;",!0,"section sign"],["&para;","&#182;",!0,"paragraph sign"],["&szlig;","&#223;",!0,"sharp s / ess-zed"],["&lsaquo;","&#8249;",!0,"single left-pointing angle quotation mark"],["&rsaquo;","&#8250;",!0,"single right-pointing angle quotation mark"],["&laquo;","&#171;",!0,"left pointing guillemet"],["&raquo;","&#187;",!0,"right pointing guillemet"],["&lsquo;","&#8216;",!0,"left single quotation mark"],["&rsquo;","&#8217;",!0,"right single quotation mark"],["&ldquo;","&#8220;",!0,"left double quotation mark"],["&rdquo;","&#8221;",!0,"right double quotation mark"],["&sbquo;","&#8218;",!0,"single low-9 quotation mark"],["&bdquo;","&#8222;",!0,"double low-9 quotation mark"],["&lt;","&#60;",!0,"less-than sign"],["&gt;","&#62;",!0,"greater-than sign"],["&le;","&#8804;",!0,"less-than or equal to"],["&ge;","&#8805;",!0,"greater-than or equal to"],["&ndash;","&#8211;",!0,"en dash"],["&mdash;","&#8212;",!0,"em dash"],["&macr;","&#175;",!0,"macron"],["&oline;","&#8254;",!0,"overline"],["&curren;","&#164;",!0,"currency sign"],["&brvbar;","&#166;",!0,"broken bar"],["&uml;","&#168;",!0,"diaeresis"],["&iexcl;","&#161;",!0,"inverted exclamation mark"],["&iquest;","&#191;",!0,"turned question mark"],["&circ;","&#710;",!0,"circumflex accent"],["&tilde;","&#732;",!0,"small tilde"],["&deg;","&#176;",!0,"degree sign"],["&minus;","&#8722;",!0,"minus sign"],["&plusmn;","&#177;",!0,"plus-minus sign"],["&divide;","&#247;",!0,"division sign"],["&frasl;","&#8260;",!0,"fraction slash"],["&times;","&#215;",!0,"multiplication sign"],["&sup1;","&#185;",!0,"superscript one"],["&sup2;","&#178;",!0,"superscript two"],["&sup3;","&#179;",!0,"superscript three"],["&frac14;","&#188;",!0,"fraction one quarter"],["&frac12;","&#189;",!0,"fraction one half"],["&frac34;","&#190;",!0,"fraction three quarters"],["&fnof;","&#402;",!0,"function / florin"],["&int;","&#8747;",!0,"integral"],["&sum;","&#8721;",!0,"n-ary sumation"],["&infin;","&#8734;",!0,"infinity"],["&radic;","&#8730;",!0,"square root"],["&sim;","&#8764;",!1,"similar to"],["&cong;","&#8773;",!1,"approximately equal to"],["&asymp;","&#8776;",!0,"almost equal to"],["&ne;","&#8800;",!0,"not equal to"],["&equiv;","&#8801;",!0,"identical to"],["&isin;","&#8712;",!1,"element of"],["&notin;","&#8713;",!1,"not an element of"],["&ni;","&#8715;",!1,"contains as member"],["&prod;","&#8719;",!0,"n-ary product"],["&and;","&#8743;",!1,"logical and"],["&or;","&#8744;",!1,"logical or"],["&not;","&#172;",!0,"not sign"],["&cap;","&#8745;",!0,"intersection"],["&cup;","&#8746;",!1,"union"],["&part;","&#8706;",!0,"partial differential"],["&forall;","&#8704;",!1,"for all"],["&exist;","&#8707;",!1,"there exists"],["&empty;","&#8709;",!1,"diameter"],["&nabla;","&#8711;",!1,"backward difference"],["&lowast;","&#8727;",!1,"asterisk operator"],["&prop;","&#8733;",!1,"proportional to"],["&ang;","&#8736;",!1,"angle"],["&acute;","&#180;",!0,"acute accent"],["&cedil;","&#184;",!0,"cedilla"],["&ordf;","&#170;",!0,"feminine ordinal indicator"],["&ordm;","&#186;",!0,"masculine ordinal indicator"],["&dagger;","&#8224;",!0,"dagger"],["&Dagger;","&#8225;",!0,"double dagger"],["&Agrave;","&#192;",!0,"A - grave"],["&Aacute;","&#193;",!0,"A - acute"],["&Acirc;","&#194;",!0,"A - circumflex"],["&Atilde;","&#195;",!0,"A - tilde"],["&Auml;","&#196;",!0,"A - diaeresis"],["&Aring;","&#197;",!0,"A - ring above"],["&AElig;","&#198;",!0,"ligature AE"],["&Ccedil;","&#199;",!0,"C - cedilla"],["&Egrave;","&#200;",!0,"E - grave"],["&Eacute;","&#201;",!0,"E - acute"],["&Ecirc;","&#202;",!0,"E - circumflex"],["&Euml;","&#203;",!0,"E - diaeresis"],["&Igrave;","&#204;",!0,"I - grave"],["&Iacute;","&#205;",!0,"I - acute"],["&Icirc;","&#206;",!0,"I - circumflex"],["&Iuml;","&#207;",!0,"I - diaeresis"],["&ETH;","&#208;",!0,"ETH"],["&Ntilde;","&#209;",!0,"N - tilde"],["&Ograve;","&#210;",!0,"O - grave"],["&Oacute;","&#211;",!0,"O - acute"],["&Ocirc;","&#212;",!0,"O - circumflex"],["&Otilde;","&#213;",!0,"O - tilde"],["&Ouml;","&#214;",!0,"O - diaeresis"],["&Oslash;","&#216;",!0,"O - slash"],["&OElig;","&#338;",!0,"ligature OE"],["&Scaron;","&#352;",!0,"S - caron"],["&Ugrave;","&#217;",!0,"U - grave"],["&Uacute;","&#218;",!0,"U - acute"],["&Ucirc;","&#219;",!0,"U - circumflex"],["&Uuml;","&#220;",!0,"U - diaeresis"],["&Yacute;","&#221;",!0,"Y - acute"],["&Yuml;","&#376;",!0,"Y - diaeresis"],["&THORN;","&#222;",!0,"THORN"],["&agrave;","&#224;",!0,"a - grave"],["&aacute;","&#225;",!0,"a - acute"],["&acirc;","&#226;",!0,"a - circumflex"],["&atilde;","&#227;",!0,"a - tilde"],["&auml;","&#228;",!0,"a - diaeresis"],["&aring;","&#229;",!0,"a - ring above"],["&aelig;","&#230;",!0,"ligature ae"],["&ccedil;","&#231;",!0,"c - cedilla"],["&egrave;","&#232;",!0,"e - grave"],["&eacute;","&#233;",!0,"e - acute"],["&ecirc;","&#234;",!0,"e - circumflex"],["&euml;","&#235;",!0,"e - diaeresis"],["&igrave;","&#236;",!0,"i - grave"],["&iacute;","&#237;",!0,"i - acute"],["&icirc;","&#238;",!0,"i - circumflex"],["&iuml;","&#239;",!0,"i - diaeresis"],["&eth;","&#240;",!0,"eth"],["&ntilde;","&#241;",!0,"n - tilde"],["&ograve;","&#242;",!0,"o - grave"],["&oacute;","&#243;",!0,"o - acute"],["&ocirc;","&#244;",!0,"o - circumflex"],["&otilde;","&#245;",!0,"o - tilde"],["&ouml;","&#246;",!0,"o - diaeresis"],["&oslash;","&#248;",!0,"o slash"],["&oelig;","&#339;",!0,"ligature oe"],["&scaron;","&#353;",!0,"s - caron"],["&ugrave;","&#249;",!0,"u - grave"],["&uacute;","&#250;",!0,"u - acute"],["&ucirc;","&#251;",!0,"u - circumflex"],["&uuml;","&#252;",!0,"u - diaeresis"],["&yacute;","&#253;",!0,"y - acute"],["&thorn;","&#254;",!0,"thorn"],["&yuml;","&#255;",!0,"y - diaeresis"],["&Alpha;","&#913;",!0,"Alpha"],["&Beta;","&#914;",!0,"Beta"],["&Gamma;","&#915;",!0,"Gamma"],["&Delta;","&#916;",!0,"Delta"],["&Epsilon;","&#917;",!0,"Epsilon"],["&Zeta;","&#918;",!0,"Zeta"],["&Eta;","&#919;",!0,"Eta"],["&Theta;","&#920;",!0,"Theta"],["&Iota;","&#921;",!0,"Iota"],["&Kappa;","&#922;",!0,"Kappa"],["&Lambda;","&#923;",!0,"Lambda"],["&Mu;","&#924;",!0,"Mu"],["&Nu;","&#925;",!0,"Nu"],["&Xi;","&#926;",!0,"Xi"],["&Omicron;","&#927;",!0,"Omicron"],["&Pi;","&#928;",!0,"Pi"],["&Rho;","&#929;",!0,"Rho"],["&Sigma;","&#931;",!0,"Sigma"],["&Tau;","&#932;",!0,"Tau"],["&Upsilon;","&#933;",!0,"Upsilon"],["&Phi;","&#934;",!0,"Phi"],["&Chi;","&#935;",!0,"Chi"],["&Psi;","&#936;",!0,"Psi"],["&Omega;","&#937;",!0,"Omega"],["&alpha;","&#945;",!0,"alpha"],["&beta;","&#946;",!0,"beta"],["&gamma;","&#947;",!0,"gamma"],["&delta;","&#948;",!0,"delta"],["&epsilon;","&#949;",!0,"epsilon"],["&zeta;","&#950;",!0,"zeta"],["&eta;","&#951;",!0,"eta"],["&theta;","&#952;",!0,"theta"],["&iota;","&#953;",!0,"iota"],["&kappa;","&#954;",!0,"kappa"],["&lambda;","&#955;",!0,"lambda"],["&mu;","&#956;",!0,"mu"],["&nu;","&#957;",!0,"nu"],["&xi;","&#958;",!0,"xi"],["&omicron;","&#959;",!0,"omicron"],["&pi;","&#960;",!0,"pi"],["&rho;","&#961;",!0,"rho"],["&sigmaf;","&#962;",!0,"final sigma"],["&sigma;","&#963;",!0,"sigma"],["&tau;","&#964;",!0,"tau"],["&upsilon;","&#965;",!0,"upsilon"],["&phi;","&#966;",!0,"phi"],["&chi;","&#967;",!0,"chi"],["&psi;","&#968;",!0,"psi"],["&omega;","&#969;",!0,"omega"],["&alefsym;","&#8501;",!1,"alef symbol"],["&piv;","&#982;",!1,"pi symbol"],["&real;","&#8476;",!1,"real part symbol"],["&thetasym;","&#977;",!1,"theta symbol"],["&upsih;","&#978;",!1,"upsilon - hook symbol"],["&weierp;","&#8472;",!1,"Weierstrass p"],["&image;","&#8465;",!1,"imaginary part"],["&larr;","&#8592;",!0,"leftwards arrow"],["&uarr;","&#8593;",!0,"upwards arrow"],["&rarr;","&#8594;",!0,"rightwards arrow"],["&darr;","&#8595;",!0,"downwards arrow"],["&harr;","&#8596;",!0,"left right arrow"],["&crarr;","&#8629;",!1,"carriage return"],["&lArr;","&#8656;",!1,"leftwards double arrow"],["&uArr;","&#8657;",!1,"upwards double arrow"],["&rArr;","&#8658;",!1,"rightwards double arrow"],["&dArr;","&#8659;",!1,"downwards double arrow"],["&hArr;","&#8660;",!1,"left right double arrow"],["&there4;","&#8756;",!1,"therefore"],["&sub;","&#8834;",!1,"subset of"],["&sup;","&#8835;",!1,"superset of"],["&nsub;","&#8836;",!1,"not a subset of"],["&sube;","&#8838;",!1,"subset of or equal to"],["&supe;","&#8839;",!1,"superset of or equal to"],["&oplus;","&#8853;",!1,"circled plus"],["&otimes;","&#8855;",!1,"circled times"],["&perp;","&#8869;",!1,"perpendicular"],["&sdot;","&#8901;",!1,"dot operator"],["&lceil;","&#8968;",!1,"left ceiling"],["&rceil;","&#8969;",!1,"right ceiling"],["&lfloor;","&#8970;",!1,"left floor"],["&rfloor;","&#8971;",!1,"right floor"],["&lang;","&#9001;",!1,"left-pointing angle bracket"],["&rang;","&#9002;",!1,"right-pointing angle bracket"],["&loz;","&#9674;",!0,"lozenge"],["&spades;","&#9824;",!1,"black spade suit"],["&clubs;","&#9827;",!0,"black club suit"],["&hearts;","&#9829;",!0,"black heart suit"],["&diams;","&#9830;",!0,"black diamond suit"],["&ensp;","&#8194;",!1,"en space"],["&emsp;","&#8195;",!1,"em space"],["&thinsp;","&#8201;",!1,"thin space"],["&zwnj;","&#8204;",!1,"zero width non-joiner"],["&zwj;","&#8205;",!1,"zero width joiner"],["&lrm;","&#8206;",!1,"left-to-right mark"],["&rlm;","&#8207;",!1,"right-to-left mark"],["&shy;","&#173;",!1,"soft hyphen"]],init:function(){var t=this.button.addAfter("horizontalrule","special-character-button",this.lang.get("insert_character"));this.button.setAwesome("special-character-button","fa-copyright"),this.button.addCallback(t,this.specialcharacters.show)},getTemplate:function(){var t=String()+'<section id="redactor-modal-advanced">';for(i=0;i<this.specialcharacters.entities.length;i++)this.specialcharacters.entities[i][2]&&(t+='<a class="re-icon-select" href="#" title="'+this.specialcharacters.entities[i][3]+'">'+this.specialcharacters.entities[i][1]+"</a> ");return t+="</section><style>.re-icon-select {font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif !important; color: black; text-decoration: none; font-size: 1.4em;  text-align: center; border: 1px solid #EEE; display: inline-block; width: 1em; margin-bottom: 0.2em; } .re-icon-select:hover {color: white; background-color: black}</style>"},show:function(){this.modal.addTemplate("specialcharacters",this.specialcharacters.getTemplate()),this.modal.load("specialcharacters",this.lang.get("insert_character"),500),this.modal.createCancelButton(),this.selection.save(),this.modal.show();var t=this.specialcharacters.insert;$(".re-icon-select").on("click",function(){return $(this).addClass("re-icon-selected"),t(),!1})},insert:function(){var t=$(".re-icon-selected").html();this.modal.close(),this.selection.restore(),this.insert.text(t),this.code.sync(),this.buffer.set()}}};